
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>4. 승촌보: 방류량 중요도 &#8212; 데이터 리포지토리</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/proof.css?v=ca93fcec" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'scb_seasonal_flow_chla_GB';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="5. 죽산보 데이터 분석" href="jsb_basics_240830.html" />
    <link rel="prev" title="3. 승촌보: 계절별 방류량과 클로로필-a" href="scb_seasonal_flow_chla.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
  
    <p class="title logo__title">데이터 리포지토리</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">메타 분석</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="meta_stats.html">1. 바이오차 메타 데이터: 기초 통계</a></li>
<li class="toctree-l1"><a class="reference internal" href="meta_pdp.html">2. 바이오차 메타 데이터: PDP 분석</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">승촌보</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="scb_seasonal_flow_chla.html">3. 승촌보: 계절별 방류량과 클로로필-a</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">4. 승촌보: 방류량 중요도</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">죽산보</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="jsb_basics_240830.html">5. 죽산보 데이터 분석</a></li>
<li class="toctree-l1"><a class="reference internal" href="jsb_scb_compared_240903.html">6. 죽산보-승촌보 데이터 비교</a></li>
<li class="toctree-l1"><a class="reference internal" href="jsb_scb_compared_240904.html">7. 죽산보-승촌보 데이터 비교: 모델 훈련 1</a></li>
<li class="toctree-l1"><a class="reference internal" href="jsb_scb_compared_240904a.html">8. 죽산보-승촌보 데이터 비교: 모델 훈련 2</a></li>
<li class="toctree-l1"><a class="reference internal" href="jsb_scb_compared_240908.html">9. 죽산보-승촌보 데이터 비교: 상관관계</a></li>
<li class="toctree-l1"><a class="reference internal" href="jsb_scb_compared_240911.html">10. 죽산보-승촌보 데이터 비교: 상관관계</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/codingalzi/dRepos/blob/master/jupyter-book/scb_seasonal_flow_chla_GB.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Colab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Colab logo" src="_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/codingalzi/dRepos" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/codingalzi/dRepos/issues/new?title=Issue%20on%20page%20%2Fscb_seasonal_flow_chla_GB.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/scb_seasonal_flow_chla_GB.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>승촌보: 방류량 중요도</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">4.1. 데이터 정보</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">4.2. 주요 내용</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">4.3. 필수 모듈 임포트</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">4.4. 승촌보 데이터 불러오기</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">4.4.1. 수질 데이터 불러오기</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">4.4.2. 승촌보 유량 데이터 추가</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id8">4.4.3. 연도별 유량 데이터 통합</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id9">4.4.4. 수질/유량 데이터 합병</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id10">4.4.5. 이상치 제거</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id11">4.5. 데이터셋 전처리</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id12">4.5.1. 클로로필 정규화</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id13">4.5.2. 결측치 보간</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id14">4.6. 방류량과 수온의 평균값 활용</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id15">4.7. 모델 훈련</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#gradientboosting">4.7.1. GradientBoosting</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id16">4.8. 최고 모델 특성 파악</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id17">4.8.1. 특성 중요도</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id18">4.8.2. 모델 성능</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="id1">
<h1><span class="section-number">4. </span>승촌보: 방류량 중요도<a class="headerlink" href="#id1" title="Link to this heading">#</a></h1>
<section id="id2">
<h2><span class="section-number">4.1. </span>데이터 정보<a class="headerlink" href="#id2" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>승촌보 수질 데이터(Seungchonbo.xlsx)</p>
<ul>
<li><p>2012-2022년</p></li>
<li><p>시간 단위 수집 데이터</p></li>
</ul>
</li>
<li><p>승촌보 유량 데이터(Seungchonbo_flow.xlsx)</p>
<ul>
<li><p>2012-2022년</p></li>
<li><p>10분 단위 수집 데이터</p></li>
</ul>
</li>
</ul>
</section>
<section id="id3">
<h2><span class="section-number">4.2. </span>주요 내용<a class="headerlink" href="#id3" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>GB 모델을 활용하여 지난 시간동안의 방류량이 중요함을 확인한다.</p></li>
<li><p>단지 하룻동안이 아닌 2, 3일 동안의 평균 방류량이 클로로필-a 농도를 예측할 때 가장 중요한 요소로 작동함을 입증한다.</p></li>
</ul>
</section>
<section id="id4">
<h2><span class="section-number">4.3. </span>필수 모듈 임포트<a class="headerlink" href="#id4" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>

<span class="kn">import</span> <span class="nn">joblib</span>

<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span> <span class="nn">datetime</span> <span class="k">as</span> <span class="nn">dt</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">GridSearchCV</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestRegressor</span><span class="p">,</span> <span class="n">GradientBoostingRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span>

<span class="c1"># 모델 저장</span>
<span class="kn">import</span> <span class="nn">joblib</span>
</pre></div>
</div>
</div>
</div>
<p><strong>그래프 설정</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># seaborn 스타일 지정</span>
<span class="c1"># sns.set_style(&quot;whitegrid&quot;)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set_style</span><span class="p">(</span><span class="s2">&quot;white&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;figure&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>  <span class="c1"># 그래프 기본 크기 지정</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;font&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">22</span><span class="p">)</span>            <span class="c1"># 폰트 크기</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;axes&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>        <span class="c1"># 축 두께</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;axes&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>      <span class="c1"># 축 색상</span>

<span class="c1"># show tick marks</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;xtick.bottom&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;ytick.left&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

<span class="c1"># Set the default font</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.family&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Times New Roman&#39;</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.serif&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Times New Roman&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p><strong>그래프 한글 설정</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># # 운영체제에 따른 한글 지원을 설정한다. 지원되는 환경은 윈도우, 우분투, 구글 코랩 등이다.</span>

<span class="c1"># import platform</span>
<span class="c1"># plt.rc(&#39;figure&#39;, figsize=(10, 6))  # 그림 크기 설정</span>
<span class="c1"># if platform.system() == &#39;Windows&#39;: # 윈도우</span>
<span class="c1">#     from matplotlib import font_manager, rc</span>
<span class="c1">#     font_path = &quot;C:/Windows/Fonts/gulim.ttc&quot;</span>
<span class="c1">#     font = font_manager.FontProperties(fname=font_path).get_name()</span>
<span class="c1">#     rc(&#39;font&#39;, family=font)</span>
<span class="c1"># elif platform.system() == &#39;Linux&#39;: # 우분투 또는 구글 코랩</span>
<span class="c1">#     # !sudo apt-get install -y fonts-nanum*</span>
<span class="c1">#     # !fc-cache -fv</span>
    
<span class="c1">#     applyfont = &quot;NanumBarunGothic&quot;</span>
<span class="c1">#     import matplotlib.font_manager as fm</span>
<span class="c1">#     if not any(map(lambda ft: ft.name == applyfont, fm.fontManager.ttflist)):</span>
<span class="c1">#         fm.fontManager.addfont(&quot;/usr/share/fonts/truetype/nanum/NanumBarunGothic.ttf&quot;)</span>
<span class="c1">#     plt.rc(&quot;font&quot;, family=applyfont)</span>
<span class="c1">#     plt.rc(&quot;axes&quot;, unicode_minus=False)</span>
</pre></div>
</div>
</div>
</div>
<p><strong>이미지 저장 함수</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="n">IMAGES_PATH</span> <span class="o">=</span> <span class="n">Path</span><span class="p">()</span> <span class="o">/</span> <span class="s2">&quot;images&quot;</span> 
<span class="n">IMAGES_PATH</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">save_fig</span><span class="p">(</span><span class="n">fig_id</span><span class="p">,</span> <span class="n">fig_extension</span><span class="o">=</span><span class="s2">&quot;png&quot;</span><span class="p">,</span> <span class="n">tight_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="mi">300</span><span class="p">):</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">IMAGES_PATH</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fig_id</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">fig_extension</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">if</span> <span class="n">tight_layout</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="n">fig_extension</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">resolution</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>

<span class="kn">import</span> <span class="nn">joblib</span>

<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span> <span class="nn">datetime</span> <span class="k">as</span> <span class="nn">dt</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id5">
<h2><span class="section-number">4.4. </span>승촌보 데이터 불러오기<a class="headerlink" href="#id5" title="Link to this heading">#</a></h2>
<section id="id6">
<h3><span class="section-number">4.4.1. </span>수질 데이터 불러오기<a class="headerlink" href="#id6" title="Link to this heading">#</a></h3>
<p><strong>보 이름</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">weir</span> <span class="o">=</span> <span class="s1">&#39;Seungchonbo&#39;</span>
</pre></div>
</div>
</div>
</div>
<p><strong>데이터 저장소</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">base_path</span> <span class="o">=</span> <span class="n">weir</span>
</pre></div>
</div>
</div>
</div>
<p><strong>시간 단위로 측정된 승촌보 연도별 수질 데이터 불러오기</strong></p>
<p><code class="docutils literal notranslate"><span class="pre">'측정일/월'</span></code> 특성은 date time으로 파싱.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ! pip install openpyxl</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># &#39;측정일/월&#39; 특성은 date time으로 파싱.</span>
<span class="c1"># 반환값은 연도별 데이터프레임으로 구성된 사전. 2012년 ~ 2022년</span>

<span class="n">data_file</span> <span class="o">=</span> <span class="n">weir</span><span class="o">+</span><span class="s2">&quot;.xlsx&quot;</span>
<span class="n">scb_yearly</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">base_path</span><span class="o">+</span><span class="n">data_file</span><span class="p">,</span> 
                            <span class="n">skiprows</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> 
                            <span class="n">header</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> 
                            <span class="n">sheet_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                            <span class="n">na_values</span><span class="o">=</span><span class="s1">&#39;ND&#39;</span><span class="p">,</span>
                            <span class="n">parse_dates</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>  <span class="c1"># 측정일/월 특성을 date time으로 파싱</span>
</pre></div>
</div>
</div>
</div>
<p><strong>2012년도 데이터를 제외한 모든 데이터 통합 함수</strong></p>
<p>2012년도 데이터는 결측치가 너무 많음.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 2013년도 데이터부터 합침</span>
<span class="c1"># 반환값은 데이터프레임</span>

<span class="k">def</span> <span class="nf">concat_yearly_df</span><span class="p">(</span><span class="n">df_yearly_dict</span><span class="p">):</span>
    <span class="n">df_concat</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">df_yearly_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">1</span><span class="p">:]:</span>
        <span class="n">df_concat</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df_concat</span><span class="p">,</span> <span class="n">df_yearly_dict</span><span class="p">[</span><span class="n">year</span><span class="p">]])</span>

    <span class="k">return</span> <span class="n">df_concat</span>
</pre></div>
</div>
</div>
</div>
<p><strong>연도별 수질 데이터 통합</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 2013년도부터 통합</span>
<span class="n">scb_yearly_df13</span> <span class="o">=</span> <span class="n">concat_yearly_df</span><span class="p">(</span><span class="n">scb_yearly</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scb_yearly_df13</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Index([&#39;측정일/월&#39;, &#39;측정소명&#39;, &#39;수온 ℃&#39;, &#39;수소이온농도&#39;, &#39;전기전도도 μS/cm&#39;, &#39;용존산소 mg/L&#39;,
       &#39;총유기탄소 mg/L&#39;, &#39;총질소 mg/L&#39;, &#39;총인 mg/L&#39;, &#39;클로로필-a mg/㎥&#39;],
      dtype=&#39;object&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scb_yearly_df13</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>측정일/월</th>
      <th>측정소명</th>
      <th>수온 ℃</th>
      <th>수소이온농도</th>
      <th>전기전도도 μS/cm</th>
      <th>용존산소 mg/L</th>
      <th>총유기탄소 mg/L</th>
      <th>총질소 mg/L</th>
      <th>총인 mg/L</th>
      <th>클로로필-a mg/㎥</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2013-01-01 00:00:00</td>
      <td>용봉</td>
      <td>3.9</td>
      <td>6.9</td>
      <td>374.0</td>
      <td>11.4</td>
      <td>2.5</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>7.2</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2013-01-01 01:00:00</td>
      <td>용봉</td>
      <td>3.9</td>
      <td>6.9</td>
      <td>375.0</td>
      <td>11.4</td>
      <td>2.5</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>6.9</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2013-01-01 02:00:00</td>
      <td>용봉</td>
      <td>4.0</td>
      <td>6.9</td>
      <td>374.0</td>
      <td>11.4</td>
      <td>2.5</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>6.8</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2013-01-01 03:00:00</td>
      <td>용봉</td>
      <td>4.1</td>
      <td>6.9</td>
      <td>375.0</td>
      <td>11.4</td>
      <td>2.5</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>6.9</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2013-01-01 04:00:00</td>
      <td>용봉</td>
      <td>4.0</td>
      <td>6.9</td>
      <td>380.0</td>
      <td>11.3</td>
      <td>2.6</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>6.9</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>3427</th>
      <td>2022-05-23 19:00:00</td>
      <td>용봉</td>
      <td>26.6</td>
      <td>6.9</td>
      <td>419.0</td>
      <td>NaN</td>
      <td>6.7</td>
      <td>5.825</td>
      <td>0.108</td>
      <td>66.2</td>
    </tr>
    <tr>
      <th>3428</th>
      <td>2022-05-23 20:00:00</td>
      <td>용봉</td>
      <td>26.3</td>
      <td>6.8</td>
      <td>425.0</td>
      <td>NaN</td>
      <td>6.5</td>
      <td>5.803</td>
      <td>0.107</td>
      <td>61.2</td>
    </tr>
    <tr>
      <th>3429</th>
      <td>2022-05-23 21:00:00</td>
      <td>용봉</td>
      <td>25.9</td>
      <td>6.8</td>
      <td>417.0</td>
      <td>NaN</td>
      <td>6.7</td>
      <td>5.909</td>
      <td>0.107</td>
      <td>58.3</td>
    </tr>
    <tr>
      <th>3430</th>
      <td>2022-05-23 22:00:00</td>
      <td>용봉</td>
      <td>25.7</td>
      <td>6.8</td>
      <td>420.0</td>
      <td>NaN</td>
      <td>6.4</td>
      <td>5.921</td>
      <td>0.106</td>
      <td>54.4</td>
    </tr>
    <tr>
      <th>3431</th>
      <td>2022-05-23 23:00:00</td>
      <td>용봉</td>
      <td>25.5</td>
      <td>6.8</td>
      <td>411.0</td>
      <td>NaN</td>
      <td>6.4</td>
      <td>5.818</td>
      <td>0.106</td>
      <td>52.3</td>
    </tr>
  </tbody>
</table>
<p>82257 rows × 10 columns</p>
</div></div></div>
</div>
<p><strong>인덱스 지정 및 이름 수정</strong></p>
<p>인덱스를 <code class="docutils literal notranslate"><span class="pre">'측정일/월'</span></code> 특성으로 변경한다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scb_yearly_df13</span> <span class="o">=</span> <span class="n">scb_yearly_df13</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;측정일/월&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>인덱스의 이름도 변경한다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scb_yearly_df13</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;DateTime&#39;</span>
</pre></div>
</div>
</div>
</div>
<p>인덱스(<code class="docutils literal notranslate"><span class="pre">'DateTime'</span></code>) 기준으로 정렬한다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scb_yearly_df13</span> <span class="o">=</span> <span class="n">scb_yearly_df13</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scb_yearly_df13</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>측정소명</th>
      <th>수온 ℃</th>
      <th>수소이온농도</th>
      <th>전기전도도 μS/cm</th>
      <th>용존산소 mg/L</th>
      <th>총유기탄소 mg/L</th>
      <th>총질소 mg/L</th>
      <th>총인 mg/L</th>
      <th>클로로필-a mg/㎥</th>
    </tr>
    <tr>
      <th>DateTime</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2013-01-01 00:00:00</th>
      <td>용봉</td>
      <td>3.9</td>
      <td>6.9</td>
      <td>374.0</td>
      <td>11.4</td>
      <td>2.5</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>7.2</td>
    </tr>
    <tr>
      <th>2013-01-01 01:00:00</th>
      <td>용봉</td>
      <td>3.9</td>
      <td>6.9</td>
      <td>375.0</td>
      <td>11.4</td>
      <td>2.5</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>6.9</td>
    </tr>
    <tr>
      <th>2013-01-01 02:00:00</th>
      <td>용봉</td>
      <td>4.0</td>
      <td>6.9</td>
      <td>374.0</td>
      <td>11.4</td>
      <td>2.5</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>6.8</td>
    </tr>
    <tr>
      <th>2013-01-01 03:00:00</th>
      <td>용봉</td>
      <td>4.1</td>
      <td>6.9</td>
      <td>375.0</td>
      <td>11.4</td>
      <td>2.5</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>6.9</td>
    </tr>
    <tr>
      <th>2013-01-01 04:00:00</th>
      <td>용봉</td>
      <td>4.0</td>
      <td>6.9</td>
      <td>380.0</td>
      <td>11.3</td>
      <td>2.6</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>6.9</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2022-05-23 19:00:00</th>
      <td>용봉</td>
      <td>26.6</td>
      <td>6.9</td>
      <td>419.0</td>
      <td>NaN</td>
      <td>6.7</td>
      <td>5.825</td>
      <td>0.108</td>
      <td>66.2</td>
    </tr>
    <tr>
      <th>2022-05-23 20:00:00</th>
      <td>용봉</td>
      <td>26.3</td>
      <td>6.8</td>
      <td>425.0</td>
      <td>NaN</td>
      <td>6.5</td>
      <td>5.803</td>
      <td>0.107</td>
      <td>61.2</td>
    </tr>
    <tr>
      <th>2022-05-23 21:00:00</th>
      <td>용봉</td>
      <td>25.9</td>
      <td>6.8</td>
      <td>417.0</td>
      <td>NaN</td>
      <td>6.7</td>
      <td>5.909</td>
      <td>0.107</td>
      <td>58.3</td>
    </tr>
    <tr>
      <th>2022-05-23 22:00:00</th>
      <td>용봉</td>
      <td>25.7</td>
      <td>6.8</td>
      <td>420.0</td>
      <td>NaN</td>
      <td>6.4</td>
      <td>5.921</td>
      <td>0.106</td>
      <td>54.4</td>
    </tr>
    <tr>
      <th>2022-05-23 23:00:00</th>
      <td>용봉</td>
      <td>25.5</td>
      <td>6.8</td>
      <td>411.0</td>
      <td>NaN</td>
      <td>6.4</td>
      <td>5.818</td>
      <td>0.106</td>
      <td>52.3</td>
    </tr>
  </tbody>
</table>
<p>82257 rows × 9 columns</p>
</div></div></div>
</div>
</section>
<section id="id7">
<h3><span class="section-number">4.4.2. </span>승촌보 유량 데이터 추가<a class="headerlink" href="#id7" title="Link to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">시간</span></code> 특성은 date time으로 파싱해서 불러온다.</p>
<p><strong>10분 단위로 측정된 승촌보 연도별 유량 데이터 불러오기</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># `시간` 특성은 date time으로 파싱해서 불러온다.</span>
<span class="c1"># 반환값은 연도별 데이터프레임으로 구성된 사전. 2012년 ~ 2022년</span>

<span class="n">flow_data_file</span> <span class="o">=</span> <span class="n">weir</span> <span class="o">+</span> <span class="s2">&quot;_flow.xlsx&quot;</span>
<span class="n">scb_flow_yearly</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">base_path</span><span class="o">+</span><span class="n">flow_data_file</span><span class="p">,</span> 
                            <span class="n">header</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> 
                            <span class="n">sheet_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                            <span class="n">na_values</span><span class="o">=</span><span class="s1">&#39;ND&#39;</span><span class="p">,</span>
                            <span class="n">parse_dates</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>  <span class="c1"># 시간 특성을 date time으로 파싱</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id8">
<h3><span class="section-number">4.4.3. </span>연도별 유량 데이터 통합<a class="headerlink" href="#id8" title="Link to this heading">#</a></h3>
<p>수질 데이터셋과 맞추기 위해 2012년도 데이터를 제외한 데이터를 통합한다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 2013년부터 통합</span>
<span class="n">scb_flow_yearly_df</span> <span class="o">=</span> <span class="n">concat_yearly_df</span><span class="p">(</span><span class="n">scb_flow_yearly</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scb_flow_yearly_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>시간</th>
      <th>상류수위(EL.m)</th>
      <th>하류수위(EL.m)</th>
      <th>유입량(㎥/s)</th>
      <th>방류량(㎥/s)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2013-01-01 00:00:00</td>
      <td>7.50</td>
      <td>3.77</td>
      <td>19.82</td>
      <td>19.74</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2013-01-01 00:10:00</td>
      <td>7.50</td>
      <td>3.77</td>
      <td>19.78</td>
      <td>19.76</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2013-01-01 00:20:00</td>
      <td>7.50</td>
      <td>3.77</td>
      <td>19.77</td>
      <td>19.82</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2013-01-01 00:30:00</td>
      <td>7.50</td>
      <td>3.77</td>
      <td>19.77</td>
      <td>19.73</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2013-01-01 00:40:00</td>
      <td>7.50</td>
      <td>3.77</td>
      <td>19.78</td>
      <td>19.79</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>32947</th>
      <td>2022-08-17 19:10:00</td>
      <td>5.46</td>
      <td>1.60</td>
      <td>14.01</td>
      <td>19.78</td>
    </tr>
    <tr>
      <th>32948</th>
      <td>2022-08-17 19:20:00</td>
      <td>5.47</td>
      <td>1.59</td>
      <td>18.96</td>
      <td>19.78</td>
    </tr>
    <tr>
      <th>32949</th>
      <td>2022-08-17 19:30:00</td>
      <td>5.47</td>
      <td>1.58</td>
      <td>19.78</td>
      <td>19.78</td>
    </tr>
    <tr>
      <th>32950</th>
      <td>2022-08-17 19:40:00</td>
      <td>5.47</td>
      <td>1.57</td>
      <td>24.72</td>
      <td>19.78</td>
    </tr>
    <tr>
      <th>32951</th>
      <td>2022-08-17 19:50:00</td>
      <td>5.47</td>
      <td>1.56</td>
      <td>19.78</td>
      <td>19.78</td>
    </tr>
  </tbody>
</table>
<p>505981 rows × 5 columns</p>
</div></div></div>
</div>
<p>인덱스를 시간으로 지정</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scb_flow_yearly_df</span> <span class="o">=</span> <span class="n">scb_flow_yearly_df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;시간&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>인덱스 이름도 수질 데이터와의 통합을 위해 동일한 이름으로 변경한다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scb_flow_yearly_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;DateTime&#39;</span>
</pre></div>
</div>
</div>
</div>
<p>시간 기준으로 정렬</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scb_flow_yearly_df</span> <span class="o">=</span> <span class="n">scb_flow_yearly_df</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scb_flow_yearly_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>상류수위(EL.m)</th>
      <th>하류수위(EL.m)</th>
      <th>유입량(㎥/s)</th>
      <th>방류량(㎥/s)</th>
    </tr>
    <tr>
      <th>DateTime</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2013-01-01 00:00:00</th>
      <td>7.50</td>
      <td>3.77</td>
      <td>19.82</td>
      <td>19.74</td>
    </tr>
    <tr>
      <th>2013-01-01 00:10:00</th>
      <td>7.50</td>
      <td>3.77</td>
      <td>19.78</td>
      <td>19.76</td>
    </tr>
    <tr>
      <th>2013-01-01 00:20:00</th>
      <td>7.50</td>
      <td>3.77</td>
      <td>19.77</td>
      <td>19.82</td>
    </tr>
    <tr>
      <th>2013-01-01 00:30:00</th>
      <td>7.50</td>
      <td>3.77</td>
      <td>19.77</td>
      <td>19.73</td>
    </tr>
    <tr>
      <th>2013-01-01 00:40:00</th>
      <td>7.50</td>
      <td>3.77</td>
      <td>19.78</td>
      <td>19.79</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2022-08-17 19:10:00</th>
      <td>5.46</td>
      <td>1.60</td>
      <td>14.01</td>
      <td>19.78</td>
    </tr>
    <tr>
      <th>2022-08-17 19:20:00</th>
      <td>5.47</td>
      <td>1.59</td>
      <td>18.96</td>
      <td>19.78</td>
    </tr>
    <tr>
      <th>2022-08-17 19:30:00</th>
      <td>5.47</td>
      <td>1.58</td>
      <td>19.78</td>
      <td>19.78</td>
    </tr>
    <tr>
      <th>2022-08-17 19:40:00</th>
      <td>5.47</td>
      <td>1.57</td>
      <td>24.72</td>
      <td>19.78</td>
    </tr>
    <tr>
      <th>2022-08-17 19:50:00</th>
      <td>5.47</td>
      <td>1.56</td>
      <td>19.78</td>
      <td>19.78</td>
    </tr>
  </tbody>
</table>
<p>505981 rows × 4 columns</p>
</div></div></div>
</div>
<p><strong>10분 단위를 1시간 단위로 변경</strong></p>
<p>수질 데이터와의 통합을 위해 시간별 평균값을 활용한다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scb_flow_yearly_hour_df</span> <span class="o">=</span> <span class="n">scb_flow_yearly_df</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s2">&quot;H&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scb_flow_yearly_hour_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>상류수위(EL.m)</th>
      <th>하류수위(EL.m)</th>
      <th>유입량(㎥/s)</th>
      <th>방류량(㎥/s)</th>
    </tr>
    <tr>
      <th>DateTime</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2013-01-01 00:00:00</th>
      <td>7.500000</td>
      <td>3.770000</td>
      <td>19.773333</td>
      <td>19.748333</td>
    </tr>
    <tr>
      <th>2013-01-01 01:00:00</th>
      <td>7.500000</td>
      <td>3.770000</td>
      <td>19.701667</td>
      <td>19.706667</td>
    </tr>
    <tr>
      <th>2013-01-01 02:00:00</th>
      <td>7.500000</td>
      <td>3.770000</td>
      <td>19.748333</td>
      <td>19.723333</td>
    </tr>
    <tr>
      <th>2013-01-01 03:00:00</th>
      <td>7.500000</td>
      <td>3.770000</td>
      <td>19.613333</td>
      <td>19.610000</td>
    </tr>
    <tr>
      <th>2013-01-01 04:00:00</th>
      <td>7.500000</td>
      <td>3.770000</td>
      <td>19.661667</td>
      <td>19.665000</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2022-08-17 15:00:00</th>
      <td>5.536667</td>
      <td>1.618333</td>
      <td>29.261667</td>
      <td>25.190000</td>
    </tr>
    <tr>
      <th>2022-08-17 16:00:00</th>
      <td>5.525000</td>
      <td>1.638333</td>
      <td>23.243333</td>
      <td>38.923333</td>
    </tr>
    <tr>
      <th>2022-08-17 17:00:00</th>
      <td>5.483333</td>
      <td>1.626667</td>
      <td>29.068333</td>
      <td>44.878333</td>
    </tr>
    <tr>
      <th>2022-08-17 18:00:00</th>
      <td>5.470000</td>
      <td>1.566667</td>
      <td>19.131667</td>
      <td>14.925000</td>
    </tr>
    <tr>
      <th>2022-08-17 19:00:00</th>
      <td>5.468333</td>
      <td>1.581667</td>
      <td>18.811667</td>
      <td>19.368333</td>
    </tr>
  </tbody>
</table>
<p>84380 rows × 4 columns</p>
</div></div></div>
</div>
</section>
<section id="id9">
<h3><span class="section-number">4.4.4. </span>수질/유량 데이터 합병<a class="headerlink" href="#id9" title="Link to this heading">#</a></h3>
<p>수질 데이터와 유량 데이터를 <code class="docutils literal notranslate"><span class="pre">date/time</span></code> 기준으로 합병한다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># `pd.merge()`에서 `how = &#39;inner&#39;` 키워드 인자 : 두 데이터에 공통으로 사용된 시간 데이터만 추가(교집합).</span>
<span class="n">scb_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">scb_yearly_df13</span><span class="p">,</span> <span class="n">scb_flow_yearly_hour_df</span><span class="p">,</span> <span class="n">left_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 유량 특성 이름에 공백이 사용되었기에 특성명에 공백 제거</span>
<span class="n">scb_data</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">scb_data</span><span class="o">.</span><span class="n">columns</span><span class="p">)]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scb_data</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
DatetimeIndex: 82257 entries, 2013-01-01 00:00:00 to 2022-05-23 23:00:00
Data columns (total 13 columns):
 #   Column       Non-Null Count  Dtype  
---  ------       --------------  -----  
 0   측정소명         82257 non-null  object 
 1   수온 ℃         64574 non-null  float64
 2   수소이온농도       64561 non-null  float64
 3   전기전도도 μS/cm  64524 non-null  float64
 4   용존산소 mg/L    62656 non-null  float64
 5   총유기탄소 mg/L   58675 non-null  float64
 6   총질소 mg/L     59981 non-null  float64
 7   총인 mg/L      58997 non-null  float64
 8   클로로필-a mg/㎥  62876 non-null  float64
 9   상류수위(EL.m)   82231 non-null  float64
 10  하류수위(EL.m)   82231 non-null  float64
 11  유입량(㎥/s)     82231 non-null  float64
 12  방류량(㎥/s)     82231 non-null  float64
dtypes: float64(12), object(1)
memory usage: 8.8+ MB
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scb_data</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>수온 ℃</th>
      <th>수소이온농도</th>
      <th>전기전도도 μS/cm</th>
      <th>용존산소 mg/L</th>
      <th>총유기탄소 mg/L</th>
      <th>총질소 mg/L</th>
      <th>총인 mg/L</th>
      <th>클로로필-a mg/㎥</th>
      <th>상류수위(EL.m)</th>
      <th>하류수위(EL.m)</th>
      <th>유입량(㎥/s)</th>
      <th>방류량(㎥/s)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>64574.000000</td>
      <td>64561.000000</td>
      <td>64524.000000</td>
      <td>62656.000000</td>
      <td>58675.000000</td>
      <td>59981.000000</td>
      <td>58997.000000</td>
      <td>62876.000000</td>
      <td>82231.000000</td>
      <td>82231.000000</td>
      <td>82231.000000</td>
      <td>82231.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>17.309103</td>
      <td>7.032307</td>
      <td>344.310877</td>
      <td>7.500954</td>
      <td>4.341878</td>
      <td>5.358875</td>
      <td>0.118273</td>
      <td>50.969729</td>
      <td>6.451908</td>
      <td>2.465385</td>
      <td>32.146464</td>
      <td>31.964258</td>
    </tr>
    <tr>
      <th>std</th>
      <td>8.099525</td>
      <td>0.509260</td>
      <td>88.450084</td>
      <td>3.914830</td>
      <td>1.032926</td>
      <td>1.963933</td>
      <td>0.062979</td>
      <td>37.409147</td>
      <td>1.528813</td>
      <td>1.183083</td>
      <td>113.291730</td>
      <td>112.716473</td>
    </tr>
    <tr>
      <th>min</th>
      <td>1.800000</td>
      <td>6.100000</td>
      <td>92.000000</td>
      <td>0.500000</td>
      <td>1.600000</td>
      <td>0.706000</td>
      <td>0.003000</td>
      <td>1.000000</td>
      <td>2.600000</td>
      <td>-0.756667</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>9.400000</td>
      <td>6.700000</td>
      <td>280.000000</td>
      <td>4.400000</td>
      <td>3.600000</td>
      <td>3.820000</td>
      <td>0.074000</td>
      <td>20.975000</td>
      <td>5.570000</td>
      <td>1.538333</td>
      <td>11.320000</td>
      <td>11.133333</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>17.300000</td>
      <td>6.900000</td>
      <td>344.000000</td>
      <td>7.600000</td>
      <td>4.200000</td>
      <td>5.097000</td>
      <td>0.106000</td>
      <td>43.200000</td>
      <td>7.290000</td>
      <td>2.546667</td>
      <td>16.280000</td>
      <td>15.108333</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>24.700000</td>
      <td>7.100000</td>
      <td>415.000000</td>
      <td>10.400000</td>
      <td>5.000000</td>
      <td>6.660000</td>
      <td>0.148000</td>
      <td>74.100000</td>
      <td>7.520000</td>
      <td>3.550000</td>
      <td>25.570000</td>
      <td>26.649167</td>
    </tr>
    <tr>
      <th>max</th>
      <td>36.100000</td>
      <td>10.000000</td>
      <td>730.000000</td>
      <td>24.300000</td>
      <td>19.300000</td>
      <td>12.357000</td>
      <td>0.745000</td>
      <td>453.500000</td>
      <td>157.920000</td>
      <td>12.486667</td>
      <td>4581.450000</td>
      <td>4088.446667</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="id10">
<h3><span class="section-number">4.4.5. </span>이상치 제거<a class="headerlink" href="#id10" title="Link to this heading">#</a></h3>
<p>상류수위가 10 (EL.m) 이상인 데이터가 존재한다.
그런데 승촌보 수위는 그 이상이 될 수 없기에 이상치로 간주하고 삭제한다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scb_data</span> <span class="o">=</span> <span class="n">scb_data</span><span class="p">[</span><span class="n">scb_data</span><span class="p">[</span><span class="s1">&#39;상류수위(EL.m)&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">10</span><span class="p">]</span>
<span class="n">scb_data</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>수온 ℃</th>
      <th>수소이온농도</th>
      <th>전기전도도 μS/cm</th>
      <th>용존산소 mg/L</th>
      <th>총유기탄소 mg/L</th>
      <th>총질소 mg/L</th>
      <th>총인 mg/L</th>
      <th>클로로필-a mg/㎥</th>
      <th>상류수위(EL.m)</th>
      <th>하류수위(EL.m)</th>
      <th>유입량(㎥/s)</th>
      <th>방류량(㎥/s)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>64548.000000</td>
      <td>64535.000000</td>
      <td>64498.000000</td>
      <td>62630.000000</td>
      <td>58651.000000</td>
      <td>59955.000000</td>
      <td>58971.000000</td>
      <td>62850.000000</td>
      <td>82203.000000</td>
      <td>82203.000000</td>
      <td>82203.000000</td>
      <td>82203.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>17.308639</td>
      <td>7.032307</td>
      <td>344.316087</td>
      <td>7.501071</td>
      <td>4.341445</td>
      <td>5.359145</td>
      <td>0.118258</td>
      <td>50.971271</td>
      <td>6.444988</td>
      <td>2.463510</td>
      <td>31.215314</td>
      <td>31.095678</td>
    </tr>
    <tr>
      <th>std</th>
      <td>8.099587</td>
      <td>0.509353</td>
      <td>88.451036</td>
      <td>3.914639</td>
      <td>1.032804</td>
      <td>1.963861</td>
      <td>0.062981</td>
      <td>37.413957</td>
      <td>1.351669</td>
      <td>1.175611</td>
      <td>96.401627</td>
      <td>96.811397</td>
    </tr>
    <tr>
      <th>min</th>
      <td>1.800000</td>
      <td>6.100000</td>
      <td>92.000000</td>
      <td>0.500000</td>
      <td>1.600000</td>
      <td>0.706000</td>
      <td>0.003000</td>
      <td>1.000000</td>
      <td>2.600000</td>
      <td>-0.756667</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>9.400000</td>
      <td>6.700000</td>
      <td>281.000000</td>
      <td>4.400000</td>
      <td>3.600000</td>
      <td>3.821000</td>
      <td>0.074000</td>
      <td>20.900000</td>
      <td>5.570000</td>
      <td>1.538333</td>
      <td>11.320000</td>
      <td>11.133333</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>17.300000</td>
      <td>6.900000</td>
      <td>344.000000</td>
      <td>7.600000</td>
      <td>4.200000</td>
      <td>5.097000</td>
      <td>0.106000</td>
      <td>43.200000</td>
      <td>7.290000</td>
      <td>2.546667</td>
      <td>16.280000</td>
      <td>15.105000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>24.700000</td>
      <td>7.100000</td>
      <td>415.000000</td>
      <td>10.400000</td>
      <td>5.000000</td>
      <td>6.659000</td>
      <td>0.148000</td>
      <td>74.100000</td>
      <td>7.520000</td>
      <td>3.550000</td>
      <td>25.560000</td>
      <td>26.636667</td>
    </tr>
    <tr>
      <th>max</th>
      <td>36.100000</td>
      <td>10.000000</td>
      <td>730.000000</td>
      <td>24.300000</td>
      <td>19.300000</td>
      <td>12.357000</td>
      <td>0.745000</td>
      <td>453.500000</td>
      <td>9.993333</td>
      <td>9.925000</td>
      <td>3630.926667</td>
      <td>3430.493333</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
</section>
<section id="id11">
<h2><span class="section-number">4.5. </span>데이터셋 전처리<a class="headerlink" href="#id11" title="Link to this heading">#</a></h2>
<p><strong>특성 선택</strong></p>
<p>데이터 분석에 사용하지 않을 특성들은 삭제한다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">to_be_removed</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;측정소명&#39;</span><span class="p">,</span> <span class="s1">&#39;수소이온농도&#39;</span><span class="p">,</span> <span class="s1">&#39;용존산소 mg/L&#39;</span><span class="p">,</span> <span class="s1">&#39;하류수위(EL.m)&#39;</span><span class="p">,</span> <span class="s1">&#39;유입량(㎥/s)&#39;</span><span class="p">]</span>

<span class="n">scb_data</span> <span class="o">=</span> <span class="n">scb_data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">to_be_removed</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scb_data</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>수온 ℃</th>
      <th>전기전도도 μS/cm</th>
      <th>총유기탄소 mg/L</th>
      <th>총질소 mg/L</th>
      <th>총인 mg/L</th>
      <th>클로로필-a mg/㎥</th>
      <th>상류수위(EL.m)</th>
      <th>방류량(㎥/s)</th>
    </tr>
    <tr>
      <th>DateTime</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2013-01-01 00:00:00</th>
      <td>3.9</td>
      <td>374.0</td>
      <td>2.5</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>7.2</td>
      <td>7.50</td>
      <td>19.748333</td>
    </tr>
    <tr>
      <th>2013-01-01 01:00:00</th>
      <td>3.9</td>
      <td>375.0</td>
      <td>2.5</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>6.9</td>
      <td>7.50</td>
      <td>19.706667</td>
    </tr>
    <tr>
      <th>2013-01-01 02:00:00</th>
      <td>4.0</td>
      <td>374.0</td>
      <td>2.5</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>6.8</td>
      <td>7.50</td>
      <td>19.723333</td>
    </tr>
    <tr>
      <th>2013-01-01 03:00:00</th>
      <td>4.1</td>
      <td>375.0</td>
      <td>2.5</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>6.9</td>
      <td>7.50</td>
      <td>19.610000</td>
    </tr>
    <tr>
      <th>2013-01-01 04:00:00</th>
      <td>4.0</td>
      <td>380.0</td>
      <td>2.6</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>6.9</td>
      <td>7.50</td>
      <td>19.665000</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2022-05-23 19:00:00</th>
      <td>26.6</td>
      <td>419.0</td>
      <td>6.7</td>
      <td>5.825</td>
      <td>0.108</td>
      <td>66.2</td>
      <td>5.44</td>
      <td>12.766667</td>
    </tr>
    <tr>
      <th>2022-05-23 20:00:00</th>
      <td>26.3</td>
      <td>425.0</td>
      <td>6.5</td>
      <td>5.803</td>
      <td>0.107</td>
      <td>61.2</td>
      <td>5.44</td>
      <td>12.786667</td>
    </tr>
    <tr>
      <th>2022-05-23 21:00:00</th>
      <td>25.9</td>
      <td>417.0</td>
      <td>6.7</td>
      <td>5.909</td>
      <td>0.107</td>
      <td>58.3</td>
      <td>5.44</td>
      <td>12.743333</td>
    </tr>
    <tr>
      <th>2022-05-23 22:00:00</th>
      <td>25.7</td>
      <td>420.0</td>
      <td>6.4</td>
      <td>5.921</td>
      <td>0.106</td>
      <td>54.4</td>
      <td>5.44</td>
      <td>12.700000</td>
    </tr>
    <tr>
      <th>2022-05-23 23:00:00</th>
      <td>25.5</td>
      <td>411.0</td>
      <td>6.4</td>
      <td>5.818</td>
      <td>0.106</td>
      <td>52.3</td>
      <td>5.44</td>
      <td>12.770000</td>
    </tr>
  </tbody>
</table>
<p>82203 rows × 8 columns</p>
</div></div></div>
</div>
<p><strong>특성 영문명 지정</strong></p>
<p>모델 훈련에 사용되는 모든 특성명을 영문으로 변경한다.
현재 남아 있는 특성들은 다음과 같다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scb_data</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Index([&#39;수온 ℃&#39;, &#39;전기전도도 μS/cm&#39;, &#39;총유기탄소 mg/L&#39;, &#39;총질소 mg/L&#39;, &#39;총인 mg/L&#39;,
       &#39;클로로필-a mg/㎥&#39;, &#39;상류수위(EL.m)&#39;, &#39;방류량(㎥/s)&#39;],
      dtype=&#39;object&#39;)
</pre></div>
</div>
</div>
</div>
<p>각 특성의 영문명은 다음과 같다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">features_english</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;수온 ℃&#39;</span> <span class="p">:</span> <span class="s1">&#39;Temp&#39;</span><span class="p">,</span>
    <span class="s1">&#39;전기전도도 μS/cm&#39;</span> <span class="p">:</span> <span class="s1">&#39;EC&#39;</span><span class="p">,</span>
    <span class="s1">&#39;용존산소 mg/L&#39;</span> <span class="p">:</span> <span class="s1">&#39;DO&#39;</span><span class="p">,</span>
    <span class="s1">&#39;총유기탄소 mg/L&#39;</span> <span class="p">:</span> <span class="s1">&#39;TOC&#39;</span><span class="p">,</span>
    <span class="s1">&#39;총질소 mg/L&#39;</span> <span class="p">:</span> <span class="s1">&#39;TN&#39;</span><span class="p">,</span>
    <span class="s1">&#39;총인 mg/L&#39;</span> <span class="p">:</span> <span class="s1">&#39;TP&#39;</span><span class="p">,</span>
    <span class="s1">&#39;클로로필-a mg/㎥&#39;</span> <span class="p">:</span> <span class="s1">&#39;Chl-a&#39;</span><span class="p">,</span>
    <span class="s1">&#39;상류수위(EL.m)&#39;</span> <span class="p">:</span> <span class="s1">&#39;WL&#39;</span><span class="p">,</span>
    <span class="s1">&#39;하류수위(EL.m)&#39;</span> <span class="p">:</span> <span class="s1">&#39;Downstream&#39;</span><span class="p">,</span>
    <span class="s1">&#39;유입량(㎥/s)&#39;</span> <span class="p">:</span> <span class="s1">&#39;Inflow&#39;</span><span class="p">,</span>
    <span class="s1">&#39;방류량(㎥/s)&#39;</span> <span class="p">:</span> <span class="s1">&#39;D-Flow&#39;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<p>영문명으로 변경(renaming)한다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scb_data</span> <span class="o">=</span> <span class="n">scb_data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">features_english</span><span class="p">)</span>
<span class="n">scb_data</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Temp</th>
      <th>EC</th>
      <th>TOC</th>
      <th>TN</th>
      <th>TP</th>
      <th>Chl-a</th>
      <th>WL</th>
      <th>D-Flow</th>
    </tr>
    <tr>
      <th>DateTime</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2013-01-01 00:00:00</th>
      <td>3.9</td>
      <td>374.0</td>
      <td>2.5</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>7.2</td>
      <td>7.50</td>
      <td>19.748333</td>
    </tr>
    <tr>
      <th>2013-01-01 01:00:00</th>
      <td>3.9</td>
      <td>375.0</td>
      <td>2.5</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>6.9</td>
      <td>7.50</td>
      <td>19.706667</td>
    </tr>
    <tr>
      <th>2013-01-01 02:00:00</th>
      <td>4.0</td>
      <td>374.0</td>
      <td>2.5</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>6.8</td>
      <td>7.50</td>
      <td>19.723333</td>
    </tr>
    <tr>
      <th>2013-01-01 03:00:00</th>
      <td>4.1</td>
      <td>375.0</td>
      <td>2.5</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>6.9</td>
      <td>7.50</td>
      <td>19.610000</td>
    </tr>
    <tr>
      <th>2013-01-01 04:00:00</th>
      <td>4.0</td>
      <td>380.0</td>
      <td>2.6</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>6.9</td>
      <td>7.50</td>
      <td>19.665000</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2022-05-23 19:00:00</th>
      <td>26.6</td>
      <td>419.0</td>
      <td>6.7</td>
      <td>5.825</td>
      <td>0.108</td>
      <td>66.2</td>
      <td>5.44</td>
      <td>12.766667</td>
    </tr>
    <tr>
      <th>2022-05-23 20:00:00</th>
      <td>26.3</td>
      <td>425.0</td>
      <td>6.5</td>
      <td>5.803</td>
      <td>0.107</td>
      <td>61.2</td>
      <td>5.44</td>
      <td>12.786667</td>
    </tr>
    <tr>
      <th>2022-05-23 21:00:00</th>
      <td>25.9</td>
      <td>417.0</td>
      <td>6.7</td>
      <td>5.909</td>
      <td>0.107</td>
      <td>58.3</td>
      <td>5.44</td>
      <td>12.743333</td>
    </tr>
    <tr>
      <th>2022-05-23 22:00:00</th>
      <td>25.7</td>
      <td>420.0</td>
      <td>6.4</td>
      <td>5.921</td>
      <td>0.106</td>
      <td>54.4</td>
      <td>5.44</td>
      <td>12.700000</td>
    </tr>
    <tr>
      <th>2022-05-23 23:00:00</th>
      <td>25.5</td>
      <td>411.0</td>
      <td>6.4</td>
      <td>5.818</td>
      <td>0.106</td>
      <td>52.3</td>
      <td>5.44</td>
      <td>12.770000</td>
    </tr>
  </tbody>
</table>
<p>82203 rows × 8 columns</p>
</div></div></div>
</div>
<section id="id12">
<h3><span class="section-number">4.5.1. </span>클로로필 정규화<a class="headerlink" href="#id12" title="Link to this heading">#</a></h3>
<p>회귀 모델을 적용하기 전에 일평균 클로로필-a의 분포를 확인하면 왼쪽으로 치우친 형태를 보인다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">scb_data</span><span class="p">[</span><span class="s1">&#39;Chl-a&#39;</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>

<span class="c1"># xticks = np.arange(0, 201, 10)</span>
<span class="c1"># ax.set_xticks(xticks)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Chl-a ($mg/m^3$)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Frequency&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Chl-a distribution&#39;</span><span class="p">)</span>

<span class="n">save_fig</span><span class="p">(</span><span class="s1">&#39;hourly-Chl-a-hist&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/9fc773f25b3f80f65a2921dbfc4548e89b7a7d688e047692f3febc9c0b59bb96.png" src="_images/9fc773f25b3f80f65a2921dbfc4548e89b7a7d688e047692f3febc9c0b59bb96.png" />
</div>
</div>
<p>클로로필-a 수치에 <code class="docutils literal notranslate"><span class="pre">np.log1p()</span></code>함수를 적용하여 용해 클로로필-a의 분포가 보다 정규 분포에 가까워지도록 한 다음에
보다 학습이 잘되는 회귀 모델을 얻을 수 있다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">scb_data</span><span class="p">[</span><span class="s1">&#39;Chl-a&#39;</span><span class="p">]),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>

<span class="c1"># xticks = np.arange(0, 201, 10)</span>
<span class="c1"># ax.set_xticks(xticks)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Chl-a ($mg/m^3$)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Frequency&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;log(Chl-a) distribution&#39;</span><span class="p">)</span>

<span class="n">save_fig</span><span class="p">(</span><span class="s1">&#39;hourly-loc-Chl-a-hist&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/609713b15ae93764210dab9e80d9ee2d02e1b70d158f429663c2f63cd9abaddb.png" src="_images/609713b15ae93764210dab9e80d9ee2d02e1b70d158f429663c2f63cd9abaddb.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mf">12.5</span><span class="p">))</span>
<span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.33</span><span class="p">)</span>

<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">ax1</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">scb_data</span><span class="p">[</span><span class="s1">&#39;Chl-a&#39;</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>

<span class="c1"># xticks = np.arange(0, 201, 10)</span>
<span class="c1"># ax1.set_xticks(xticks)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Chl-a ($\mathdefault</span><span class="si">{mg}</span><span class="s1">/\mathdefault</span><span class="si">{m}</span><span class="s1">^3$)&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Frequency&#39;</span><span class="p">)</span>
<span class="c1"># ax1.grid(axis=&#39;y&#39;)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;(a)&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.03</span><span class="p">,</span> <span class="n">x</span><span class="o">=-</span><span class="mf">0.025</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">22</span><span class="p">)</span>

<span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">ax2</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">scb_data</span><span class="p">[</span><span class="s1">&#39;Chl-a&#39;</span><span class="p">]),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>

<span class="c1"># xticks = np.arange(0, 201, 10)</span>
<span class="c1"># ax2.set_xticks(xticks)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Chl-a ($\mathdefault</span><span class="si">{mg}</span><span class="s1">/\mathdefault</span><span class="si">{m}</span><span class="s1">^3$)&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Frequency&#39;</span><span class="p">)</span>
<span class="c1"># ax2.grid(axis=&#39;y&#39;)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;(b)&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.03</span><span class="p">,</span> <span class="n">x</span><span class="o">=-</span><span class="mf">0.025</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">22</span><span class="p">)</span>

<span class="n">save_fig</span><span class="p">(</span><span class="s1">&#39;figureS1&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/6c0ef63cc29bdecf89beb8aa39057d4b4739333d39147862f979b5b4cb38a9ba.png" src="_images/6c0ef63cc29bdecf89beb8aa39057d4b4739333d39147862f979b5b4cb38a9ba.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mf">12.5</span><span class="p">))</span>
<span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.33</span><span class="p">)</span>

<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">ax1</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">scb_data</span><span class="p">[</span><span class="s1">&#39;Chl-a&#39;</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>

<span class="c1"># xticks = np.arange(0, 201, 10)</span>
<span class="c1"># ax1.set_xticks(xticks)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Chl-a ($\mathdefault</span><span class="si">{mg}</span><span class="s1">/\mathdefault</span><span class="si">{m}</span><span class="s1">^3$)&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Frequency&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;(a)&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.03</span><span class="p">,</span> <span class="n">x</span><span class="o">=-</span><span class="mf">0.025</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">22</span><span class="p">)</span>

<span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">ax2</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">scb_data</span><span class="p">[</span><span class="s1">&#39;Chl-a&#39;</span><span class="p">]),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>

<span class="c1"># xticks = np.arange(0, 201, 10)</span>
<span class="c1"># ax2.set_xticks(xticks)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Chl-a ($\mathdefault</span><span class="si">{mg}</span><span class="s1">/\mathdefault</span><span class="si">{m}</span><span class="s1">^3$)&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Frequency&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;(b)&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.03</span><span class="p">,</span> <span class="n">x</span><span class="o">=-</span><span class="mf">0.025</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">22</span><span class="p">)</span>

<span class="n">save_fig</span><span class="p">(</span><span class="s1">&#39;figureS1a&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/8f436129a01a772089fa097fc94d6595e2efa51c9cb3c53bf8cd4ba23ec12eae.png" src="_images/8f436129a01a772089fa097fc94d6595e2efa51c9cb3c53bf8cd4ba23ec12eae.png" />
</div>
</div>
<p>클로로필-a 값을 로그 변환해서 <code class="docutils literal notranslate"><span class="pre">scb_df_daily</span></code>에 추가하고 원래의 클로로필-a 특성은 삭제한다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scb_data</span><span class="p">[</span><span class="s1">&#39;log_Chl-a&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">scb_data</span><span class="p">[</span><span class="s1">&#39;Chl-a&#39;</span><span class="p">])</span>
<span class="n">scb_data</span> <span class="o">=</span> <span class="n">scb_data</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;Chl-a&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scb_data</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
DatetimeIndex: 82203 entries, 2013-01-01 00:00:00 to 2022-05-23 23:00:00
Data columns (total 8 columns):
 #   Column     Non-Null Count  Dtype  
---  ------     --------------  -----  
 0   Temp       64548 non-null  float64
 1   EC         64498 non-null  float64
 2   TOC        58651 non-null  float64
 3   TN         59955 non-null  float64
 4   TP         58971 non-null  float64
 5   WL         82203 non-null  float64
 6   D-Flow     82203 non-null  float64
 7   log_Chl-a  62850 non-null  float64
dtypes: float64(8)
memory usage: 5.6 MB
</pre></div>
</div>
</div>
</div>
</section>
<section id="id13">
<h3><span class="section-number">4.5.2. </span>결측치 보간<a class="headerlink" href="#id13" title="Link to this heading">#</a></h3>
<p>머신러닝 모델을 학습시키기 위해서는 일반적으로 결측치를 제거해야 한다.
여기서는 결측치는 시간을 기준으로 선형 보간법을 사용한다.
결측치는 양방향 12시간씩, 결측 구간별 최대 24시간의 결측치를 대체한다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scb_df</span> <span class="o">=</span> <span class="n">scb_data</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">limit</span> <span class="o">=</span> <span class="mi">12</span><span class="p">,</span> <span class="n">limit_direction</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scb_df</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
DatetimeIndex: 82203 entries, 2013-01-01 00:00:00 to 2022-05-23 23:00:00
Data columns (total 8 columns):
 #   Column     Non-Null Count  Dtype  
---  ------     --------------  -----  
 0   Temp       68243 non-null  float64
 1   EC         68241 non-null  float64
 2   TOC        64092 non-null  float64
 3   TN         64508 non-null  float64
 4   TP         64252 non-null  float64
 5   WL         82203 non-null  float64
 6   D-Flow     82203 non-null  float64
 7   log_Chl-a  66385 non-null  float64
dtypes: float64(8)
memory usage: 5.6 MB
</pre></div>
</div>
</div>
</div>
<p>그래도 남은 결측치는 모두 제거한다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scb_df</span> <span class="o">=</span> <span class="n">scb_df</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="n">scb_df</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
DatetimeIndex: 59034 entries, 2013-03-29 04:00:00 to 2022-05-23 23:00:00
Data columns (total 8 columns):
 #   Column     Non-Null Count  Dtype  
---  ------     --------------  -----  
 0   Temp       59034 non-null  float64
 1   EC         59034 non-null  float64
 2   TOC        59034 non-null  float64
 3   TN         59034 non-null  float64
 4   TP         59034 non-null  float64
 5   WL         59034 non-null  float64
 6   D-Flow     59034 non-null  float64
 7   log_Chl-a  59034 non-null  float64
dtypes: float64(8)
memory usage: 4.1 MB
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="id14">
<h2><span class="section-number">4.6. </span>방류량과 수온의 평균값 활용<a class="headerlink" href="#id14" title="Link to this heading">#</a></h2>
<p><strong><code class="docutils literal notranslate"><span class="pre">feature_windowing()</span></code> 함수</strong></p>
<p>지정된 특성에 대해 일(day) 단위의 윈도우(window)를 사용하여 지정된 기간동안의 평균값을 새로운 특성으로 추가한다.
특성의 기본값으로 수온과 방류량을 사용한다.</p>
<ul class="simple">
<li><p>일(24시간) 단위로 윈도우 사용</p></li>
<li><p>일(day) 수를 지정하면 24시간 단위로 변환해서 윈도우 적용.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">feature_windowing</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Temp&#39;</span><span class="p">,</span> <span class="s1">&#39;D-Flow&#39;</span><span class="p">],</span> <span class="n">window</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    df: 주어진 데이터프레임</span>
<span class="sd">    feature: 윈도우 적용대상 특성. 기본값은 방류량.</span>
<span class="sd">    window: 일(day) 단위 윈도우 크기. 기본값은 2일.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">window_</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">window</span><span class="o">*</span><span class="mi">24</span><span class="si">}</span><span class="s2">H&quot;</span> <span class="c1"># 일 단위를 24시간 단위로 변환</span>

    <span class="n">new_features</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">ft</span> <span class="ow">in</span> <span class="n">features</span><span class="p">:</span>
        <span class="n">new_features</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">window</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;d&#39;</span><span class="o">+</span><span class="n">ft</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">ft</span><span class="p">]</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="n">window_</span><span class="p">,</span> <span class="n">min_periods</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="n">new_features</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">new_features</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df</span><span class="p">,</span> <span class="n">new_features</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>예를 들어 지난 이틀 동안의 수온과 방류량의 평균값을 새로운 특성으로 추가한 결과는 다음과 같다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">feature_windowing</span><span class="p">(</span><span class="n">scb_df</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Temp&#39;</span><span class="p">,</span> <span class="s1">&#39;D-Flow&#39;</span><span class="p">],</span> <span class="n">window</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Temp</th>
      <th>EC</th>
      <th>TOC</th>
      <th>TN</th>
      <th>TP</th>
      <th>WL</th>
      <th>D-Flow</th>
      <th>log_Chl-a</th>
      <th>2dTemp</th>
      <th>2dD-Flow</th>
    </tr>
    <tr>
      <th>DateTime</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2013-03-29 04:00:00</th>
      <td>13.2</td>
      <td>296.0</td>
      <td>3.4</td>
      <td>5.866</td>
      <td>0.104</td>
      <td>7.540000</td>
      <td>13.578333</td>
      <td>4.332048</td>
      <td>13.200000</td>
      <td>13.578333</td>
    </tr>
    <tr>
      <th>2013-03-29 05:00:00</th>
      <td>13.1</td>
      <td>296.0</td>
      <td>3.3</td>
      <td>5.866</td>
      <td>0.104</td>
      <td>7.540000</td>
      <td>13.563333</td>
      <td>4.316154</td>
      <td>13.150000</td>
      <td>13.570833</td>
    </tr>
    <tr>
      <th>2013-03-29 06:00:00</th>
      <td>12.9</td>
      <td>296.0</td>
      <td>3.3</td>
      <td>5.866</td>
      <td>0.104</td>
      <td>7.540000</td>
      <td>13.578333</td>
      <td>4.300003</td>
      <td>13.066667</td>
      <td>13.573333</td>
    </tr>
    <tr>
      <th>2013-03-29 07:00:00</th>
      <td>12.6</td>
      <td>294.0</td>
      <td>3.3</td>
      <td>5.866</td>
      <td>0.104</td>
      <td>7.536667</td>
      <td>13.193333</td>
      <td>4.218036</td>
      <td>12.950000</td>
      <td>13.478333</td>
    </tr>
    <tr>
      <th>2013-03-29 08:00:00</th>
      <td>12.5</td>
      <td>292.0</td>
      <td>3.3</td>
      <td>5.866</td>
      <td>0.104</td>
      <td>7.530000</td>
      <td>12.333333</td>
      <td>4.158883</td>
      <td>12.860000</td>
      <td>13.249333</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2022-05-23 19:00:00</th>
      <td>26.6</td>
      <td>419.0</td>
      <td>6.7</td>
      <td>5.825</td>
      <td>0.108</td>
      <td>5.440000</td>
      <td>12.766667</td>
      <td>4.207673</td>
      <td>24.570833</td>
      <td>11.447187</td>
    </tr>
    <tr>
      <th>2022-05-23 20:00:00</th>
      <td>26.3</td>
      <td>425.0</td>
      <td>6.5</td>
      <td>5.803</td>
      <td>0.107</td>
      <td>5.440000</td>
      <td>12.786667</td>
      <td>4.130355</td>
      <td>24.616667</td>
      <td>11.447812</td>
    </tr>
    <tr>
      <th>2022-05-23 21:00:00</th>
      <td>25.9</td>
      <td>417.0</td>
      <td>6.7</td>
      <td>5.909</td>
      <td>0.107</td>
      <td>5.440000</td>
      <td>12.743333</td>
      <td>4.082609</td>
      <td>24.656250</td>
      <td>11.448750</td>
    </tr>
    <tr>
      <th>2022-05-23 22:00:00</th>
      <td>25.7</td>
      <td>420.0</td>
      <td>6.4</td>
      <td>5.921</td>
      <td>0.106</td>
      <td>5.440000</td>
      <td>12.700000</td>
      <td>4.014580</td>
      <td>24.693750</td>
      <td>11.449028</td>
    </tr>
    <tr>
      <th>2022-05-23 23:00:00</th>
      <td>25.5</td>
      <td>411.0</td>
      <td>6.4</td>
      <td>5.818</td>
      <td>0.106</td>
      <td>5.440000</td>
      <td>12.770000</td>
      <td>3.975936</td>
      <td>24.729167</td>
      <td>11.450833</td>
    </tr>
  </tbody>
</table>
<p>59034 rows × 10 columns</p>
</div></div></div>
</div>
</section>
<section id="id15">
<h2><span class="section-number">4.7. </span>모델 훈련<a class="headerlink" href="#id15" title="Link to this heading">#</a></h2>
<p><strong>훈련 특성과 타깃</strong></p>
<ul class="simple">
<li><p>훈련 특성: 클로로필-a를 제외한 특성 + 최대 14일 동안의 방류량/수온 평균값</p></li>
<li><p>타깃 특성: <code class="docutils literal notranslate"><span class="pre">log_Chl-a</span></code></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scb_df</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Index([&#39;Temp&#39;, &#39;EC&#39;, &#39;TOC&#39;, &#39;TN&#39;, &#39;TP&#39;, &#39;WL&#39;, &#39;D-Flow&#39;, &#39;log_Chl-a&#39;], dtype=&#39;object&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">features_to_remove</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;log_Chl-a&#39;</span><span class="p">]</span>
<span class="n">basic_features</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Temp&#39;</span><span class="p">,</span> <span class="s1">&#39;EC&#39;</span><span class="p">,</span> <span class="s1">&#39;TOC&#39;</span><span class="p">,</span> <span class="s1">&#39;TN&#39;</span><span class="p">,</span> <span class="s1">&#39;TP&#39;</span><span class="p">,</span> <span class="s1">&#39;WL&#39;</span><span class="p">,</span> <span class="s1">&#39;D-Flow&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<section id="gradientboosting">
<h3><span class="section-number">4.7.1. </span>GradientBoosting<a class="headerlink" href="#gradientboosting" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gb_reg</span> <span class="o">=</span> <span class="n">GradientBoostingRegressor</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>이전 훈련 결과에 의해 하이퍼파라미터의 아래 조합이 가장 좋은 성능을 보였다.
따라서 여기서는 훈련 시간을 절약하기 위해 하나의 조합만 사용한다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;subsample&quot;</span><span class="p">:[</span><span class="mf">0.6</span><span class="p">],</span>
    <span class="s1">&#39;max_depth&#39;</span><span class="p">:[</span><span class="mi">10</span><span class="p">],</span> 
    <span class="s2">&quot;learning_rate&quot;</span><span class="p">:[</span><span class="mf">0.05</span><span class="p">],</span>
    <span class="s1">&#39;n_estimators&#39;</span><span class="p">:[</span><span class="mi">1200</span><span class="p">]</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<p>훈련된 최고의 모델을 저장할 디렉토리를 지정한다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">best_models_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">()</span> <span class="o">/</span> <span class="s2">&quot;best_models_1&quot;</span>
<span class="n">best_models_path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><strong><code class="docutils literal notranslate"><span class="pre">gridsearch()</span></code> 함수</strong></p>
<p>그리드 탐색 훈련을 진행한다.</p>
<ul class="simple">
<li><p>모델, 하이퍼파라미터 조합, 특성, 윈도우 크기가 정해지면 해당 특성의 지정된 크기만큼의 윈도우 기간 동안의 평균값을 새로운 특성으로 추가한다.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">gridsearch</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Temp&#39;</span><span class="p">,</span> <span class="s1">&#39;D-Flow&#39;</span><span class="p">],</span> <span class="n">windows</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span> <span class="n">cv</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>

    <span class="c1"># best models</span>
    <span class="n">best_model_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="c1"># best models names</span>
    <span class="n">best_model_name_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="c1"># test r2 scores of the best models</span>
    <span class="n">test_score_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="c1"># test rmse scores of the best models</span>
    <span class="n">test_score_rmse_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="c1"># train features of the best models</span>
    <span class="n">input_features_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="c1"># best hyperparameters for each window</span>
    <span class="n">best_params_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    
    <span class="k">for</span> <span class="n">window</span> <span class="ow">in</span> <span class="n">windows</span><span class="p">:</span>
        <span class="c1"># window 특성 추가</span>
        <span class="n">dataset_window</span> <span class="o">=</span> <span class="n">feature_windowing</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="n">window</span><span class="p">)</span>
        <span class="c1"># 결측치 제거</span>
        <span class="n">dataset_window</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># 입력 및 타깃 특성 지정</span>
        <span class="n">features_to_be_removed</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;log_Chl-a&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">features</span>
        <span class="n">features_</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">dataset_window</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ft</span> <span class="ow">in</span> <span class="n">features_to_be_removed</span><span class="p">:</span>
            <span class="n">features_</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">ft</span><span class="p">)</span>
        
        <span class="n">input_features</span> <span class="o">=</span> <span class="n">features_</span>
        <span class="n">target_feature</span> <span class="o">=</span> <span class="s1">&#39;log_Chl-a&#39;</span>

        <span class="c1"># 입력 및 타깃 데이터셋 지정</span>
        <span class="n">inputs</span> <span class="o">=</span> <span class="n">dataset_window</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">input_features</span><span class="p">]</span>
        <span class="n">targets</span> <span class="o">=</span> <span class="n">dataset_window</span><span class="p">[</span><span class="n">target_feature</span><span class="p">]</span>

        <span class="c1"># 훈련셋과 테스트셋 분리</span>
        <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">targets</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

        <span class="c1"># 그리드 탐색 훈련 시작</span>
        <span class="n">added_feature</span> <span class="o">=</span> <span class="n">window</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;===</span><span class="si">{</span><span class="n">added_feature</span><span class="si">}</span><span class="s2">day(s) temperature and discharge added===&quot;</span><span class="p">)</span>

        <span class="n">model_grid</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">param_grid</span><span class="o">=</span><span class="n">parameters</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;r2&#39;</span><span class="p">,</span> <span class="s1">&#39;neg_mean_squared_error&#39;</span><span class="p">],</span> <span class="n">refit</span><span class="o">=</span><span class="s1">&#39;r2&#39;</span><span class="p">)</span>
        <span class="n">model_grid</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

        <span class="c1"># 최적 모델 저장</span>
        <span class="n">estimator</span> <span class="o">=</span> <span class="n">model_grid</span><span class="o">.</span><span class="n">best_estimator_</span>

        <span class="n">best_model</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">added_feature</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;days&quot;</span><span class="o">+</span><span class="s2">&quot;.pkl&quot;</span>
        <span class="n">joblib</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">estimator</span><span class="p">,</span> <span class="n">best_models_path</span> <span class="o">/</span> <span class="n">best_model</span><span class="p">)</span>

        <span class="c1"># 저장된 모델 다시 불러오기</span>
        <span class="n">estimator</span> <span class="o">=</span> <span class="n">joblib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">best_models_path</span> <span class="o">/</span> <span class="n">best_model</span><span class="p">)</span>

        <span class="n">best_model_dict</span><span class="p">[</span><span class="n">added_feature</span><span class="p">]</span> <span class="o">=</span> <span class="n">estimator</span>
        <span class="n">best_model_name_dict</span><span class="p">[</span><span class="n">added_feature</span><span class="p">]</span> <span class="o">=</span> <span class="n">best_model</span>
        <span class="n">test_score_dict</span><span class="p">[</span><span class="n">added_feature</span><span class="p">]</span> <span class="o">=</span> <span class="n">estimator</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
        <span class="n">test_score_rmse_dict</span><span class="p">[</span><span class="n">added_feature</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">estimator</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)))</span>
        <span class="n">input_features_dict</span><span class="p">[</span><span class="n">added_feature</span><span class="p">]</span> <span class="o">=</span> <span class="n">input_features</span>
        <span class="n">best_params_dict</span><span class="p">[</span><span class="n">added_feature</span><span class="p">]</span> <span class="o">=</span> <span class="n">model_grid</span><span class="o">.</span><span class="n">best_params_</span>

    <span class="k">return</span> <span class="n">best_model_dict</span><span class="p">,</span> <span class="n">best_model_name_dict</span><span class="p">,</span> <span class="n">test_score_dict</span><span class="p">,</span> <span class="n">test_score_rmse_dict</span><span class="p">,</span> <span class="n">input_features_dict</span><span class="p">,</span> <span class="n">best_params_dict</span>
</pre></div>
</div>
</div>
</div>
<p>수온과 방류량을 기준으로 1일부터 14일까지의 윈도우를 개별적으로 적용하여 훈련한다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">window_features</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Temp&#39;</span><span class="p">,</span> <span class="s1">&#39;D-Flow&#39;</span><span class="p">]</span>
<span class="n">windows</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span>

<span class="n">dicts</span> <span class="o">=</span> <span class="n">gridsearch</span><span class="p">(</span><span class="n">scb_df</span><span class="p">,</span> <span class="n">gb_reg</span><span class="p">,</span> <span class="n">param_grid</span><span class="p">,</span> <span class="n">window_features</span><span class="p">,</span> <span class="n">windows</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">best_model_dict</span><span class="p">,</span> <span class="n">best_model_name_dict</span><span class="p">,</span> <span class="n">test_score_dict</span><span class="p">,</span> <span class="n">test_score_rmse_dict</span><span class="p">,</span> <span class="n">input_features_dict</span><span class="p">,</span> <span class="n">best_params_dict</span> <span class="o">=</span> <span class="n">dicts</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>===1day(s) temperature and discharge added===
Fitting 3 folds for each of 1 candidates, totalling 3 fits
[CV 1/3] END learning_rate=0.05, max_depth=10, n_estimators=1200, subsample=0.6; neg_mean_squared_error: (test=-0.029) r2: (test=0.963) total time= 4.3min
[CV 2/3] END learning_rate=0.05, max_depth=10, n_estimators=1200, subsample=0.6; neg_mean_squared_error: (test=-0.029) r2: (test=0.964) total time= 4.3min
[CV 3/3] END learning_rate=0.05, max_depth=10, n_estimators=1200, subsample=0.6; neg_mean_squared_error: (test=-0.031) r2: (test=0.962) total time= 3.9min
===2day(s) temperature and discharge added===
Fitting 3 folds for each of 1 candidates, totalling 3 fits
[CV 1/3] END learning_rate=0.05, max_depth=10, n_estimators=1200, subsample=0.6; neg_mean_squared_error: (test=-0.025) r2: (test=0.968) total time= 4.1min
[CV 2/3] END learning_rate=0.05, max_depth=10, n_estimators=1200, subsample=0.6; neg_mean_squared_error: (test=-0.025) r2: (test=0.969) total time= 4.1min
[CV 3/3] END learning_rate=0.05, max_depth=10, n_estimators=1200, subsample=0.6; neg_mean_squared_error: (test=-0.026) r2: (test=0.968) total time= 4.1min
===3day(s) temperature and discharge added===
Fitting 3 folds for each of 1 candidates, totalling 3 fits
[CV 1/3] END learning_rate=0.05, max_depth=10, n_estimators=1200, subsample=0.6; neg_mean_squared_error: (test=-0.024) r2: (test=0.970) total time= 4.2min
[CV 2/3] END learning_rate=0.05, max_depth=10, n_estimators=1200, subsample=0.6; neg_mean_squared_error: (test=-0.024) r2: (test=0.971) total time= 4.2min
[CV 3/3] END learning_rate=0.05, max_depth=10, n_estimators=1200, subsample=0.6; neg_mean_squared_error: (test=-0.024) r2: (test=0.971) total time= 4.2min
===4day(s) temperature and discharge added===
Fitting 3 folds for each of 1 candidates, totalling 3 fits
[CV 1/3] END learning_rate=0.05, max_depth=10, n_estimators=1200, subsample=0.6; neg_mean_squared_error: (test=-0.023) r2: (test=0.971) total time= 4.2min
[CV 2/3] END learning_rate=0.05, max_depth=10, n_estimators=1200, subsample=0.6; neg_mean_squared_error: (test=-0.023) r2: (test=0.971) total time= 4.2min
[CV 3/3] END learning_rate=0.05, max_depth=10, n_estimators=1200, subsample=0.6; neg_mean_squared_error: (test=-0.024) r2: (test=0.970) total time= 4.2min
===5day(s) temperature and discharge added===
Fitting 3 folds for each of 1 candidates, totalling 3 fits
[CV 1/3] END learning_rate=0.05, max_depth=10, n_estimators=1200, subsample=0.6; neg_mean_squared_error: (test=-0.022) r2: (test=0.972) total time= 4.2min
[CV 2/3] END learning_rate=0.05, max_depth=10, n_estimators=1200, subsample=0.6; neg_mean_squared_error: (test=-0.022) r2: (test=0.973) total time= 4.2min
[CV 3/3] END learning_rate=0.05, max_depth=10, n_estimators=1200, subsample=0.6; neg_mean_squared_error: (test=-0.023) r2: (test=0.972) total time= 4.2min
===6day(s) temperature and discharge added===
Fitting 3 folds for each of 1 candidates, totalling 3 fits
[CV 1/3] END learning_rate=0.05, max_depth=10, n_estimators=1200, subsample=0.6; neg_mean_squared_error: (test=-0.022) r2: (test=0.972) total time= 4.2min
[CV 2/3] END learning_rate=0.05, max_depth=10, n_estimators=1200, subsample=0.6; neg_mean_squared_error: (test=-0.022) r2: (test=0.973) total time= 4.2min
[CV 3/3] END learning_rate=0.05, max_depth=10, n_estimators=1200, subsample=0.6; neg_mean_squared_error: (test=-0.022) r2: (test=0.973) total time= 4.2min
===7day(s) temperature and discharge added===
Fitting 3 folds for each of 1 candidates, totalling 3 fits
[CV 1/3] END learning_rate=0.05, max_depth=10, n_estimators=1200, subsample=0.6; neg_mean_squared_error: (test=-0.021) r2: (test=0.973) total time= 4.2min
[CV 2/3] END learning_rate=0.05, max_depth=10, n_estimators=1200, subsample=0.6; neg_mean_squared_error: (test=-0.021) r2: (test=0.974) total time= 4.2min
[CV 3/3] END learning_rate=0.05, max_depth=10, n_estimators=1200, subsample=0.6; neg_mean_squared_error: (test=-0.022) r2: (test=0.973) total time= 4.2min
===8day(s) temperature and discharge added===
Fitting 3 folds for each of 1 candidates, totalling 3 fits
[CV 1/3] END learning_rate=0.05, max_depth=10, n_estimators=1200, subsample=0.6; neg_mean_squared_error: (test=-0.020) r2: (test=0.974) total time= 4.2min
[CV 2/3] END learning_rate=0.05, max_depth=10, n_estimators=1200, subsample=0.6; neg_mean_squared_error: (test=-0.019) r2: (test=0.976) total time= 4.2min
[CV 3/3] END learning_rate=0.05, max_depth=10, n_estimators=1200, subsample=0.6; neg_mean_squared_error: (test=-0.021) r2: (test=0.974) total time= 4.2min
===9day(s) temperature and discharge added===
Fitting 3 folds for each of 1 candidates, totalling 3 fits
[CV 1/3] END learning_rate=0.05, max_depth=10, n_estimators=1200, subsample=0.6; neg_mean_squared_error: (test=-0.020) r2: (test=0.974) total time= 4.2min
[CV 2/3] END learning_rate=0.05, max_depth=10, n_estimators=1200, subsample=0.6; neg_mean_squared_error: (test=-0.020) r2: (test=0.975) total time= 4.2min
[CV 3/3] END learning_rate=0.05, max_depth=10, n_estimators=1200, subsample=0.6; neg_mean_squared_error: (test=-0.020) r2: (test=0.975) total time= 4.2min
===10day(s) temperature and discharge added===
Fitting 3 folds for each of 1 candidates, totalling 3 fits
[CV 1/3] END learning_rate=0.05, max_depth=10, n_estimators=1200, subsample=0.6; neg_mean_squared_error: (test=-0.019) r2: (test=0.975) total time= 4.2min
[CV 2/3] END learning_rate=0.05, max_depth=10, n_estimators=1200, subsample=0.6; neg_mean_squared_error: (test=-0.020) r2: (test=0.975) total time= 4.3min
[CV 3/3] END learning_rate=0.05, max_depth=10, n_estimators=1200, subsample=0.6; neg_mean_squared_error: (test=-0.021) r2: (test=0.974) total time= 4.2min
===11day(s) temperature and discharge added===
Fitting 3 folds for each of 1 candidates, totalling 3 fits
[CV 1/3] END learning_rate=0.05, max_depth=10, n_estimators=1200, subsample=0.6; neg_mean_squared_error: (test=-0.020) r2: (test=0.975) total time= 4.3min
[CV 2/3] END learning_rate=0.05, max_depth=10, n_estimators=1200, subsample=0.6; neg_mean_squared_error: (test=-0.020) r2: (test=0.976) total time= 4.3min
[CV 3/3] END learning_rate=0.05, max_depth=10, n_estimators=1200, subsample=0.6; neg_mean_squared_error: (test=-0.021) r2: (test=0.975) total time= 4.3min
===12day(s) temperature and discharge added===
Fitting 3 folds for each of 1 candidates, totalling 3 fits
[CV 1/3] END learning_rate=0.05, max_depth=10, n_estimators=1200, subsample=0.6; neg_mean_squared_error: (test=-0.020) r2: (test=0.975) total time= 4.3min
[CV 2/3] END learning_rate=0.05, max_depth=10, n_estimators=1200, subsample=0.6; neg_mean_squared_error: (test=-0.019) r2: (test=0.976) total time= 4.2min
[CV 3/3] END learning_rate=0.05, max_depth=10, n_estimators=1200, subsample=0.6; neg_mean_squared_error: (test=-0.020) r2: (test=0.975) total time= 4.2min
===13day(s) temperature and discharge added===
Fitting 3 folds for each of 1 candidates, totalling 3 fits
[CV 1/3] END learning_rate=0.05, max_depth=10, n_estimators=1200, subsample=0.6; neg_mean_squared_error: (test=-0.019) r2: (test=0.976) total time= 4.1min
[CV 2/3] END learning_rate=0.05, max_depth=10, n_estimators=1200, subsample=0.6; neg_mean_squared_error: (test=-0.019) r2: (test=0.976) total time= 4.1min
[CV 3/3] END learning_rate=0.05, max_depth=10, n_estimators=1200, subsample=0.6; neg_mean_squared_error: (test=-0.019) r2: (test=0.976) total time= 4.1min
===14day(s) temperature and discharge added===
Fitting 3 folds for each of 1 candidates, totalling 3 fits
[CV 1/3] END learning_rate=0.05, max_depth=10, n_estimators=1200, subsample=0.6; neg_mean_squared_error: (test=-0.019) r2: (test=0.976) total time= 4.1min
[CV 2/3] END learning_rate=0.05, max_depth=10, n_estimators=1200, subsample=0.6; neg_mean_squared_error: (test=-0.019) r2: (test=0.976) total time= 4.1min
[CV 3/3] END learning_rate=0.05, max_depth=10, n_estimators=1200, subsample=0.6; neg_mean_squared_error: (test=-0.019) r2: (test=0.976) total time= 4.1min
</pre></div>
</div>
</div>
</div>
<p><strong>best_params_dict</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">best_params_dict</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{1: {&#39;learning_rate&#39;: 0.05,
  &#39;max_depth&#39;: 10,
  &#39;n_estimators&#39;: 1200,
  &#39;subsample&#39;: 0.6},
 2: {&#39;learning_rate&#39;: 0.05,
  &#39;max_depth&#39;: 10,
  &#39;n_estimators&#39;: 1200,
  &#39;subsample&#39;: 0.6},
 3: {&#39;learning_rate&#39;: 0.05,
  &#39;max_depth&#39;: 10,
  &#39;n_estimators&#39;: 1200,
  &#39;subsample&#39;: 0.6},
 4: {&#39;learning_rate&#39;: 0.05,
  &#39;max_depth&#39;: 10,
  &#39;n_estimators&#39;: 1200,
  &#39;subsample&#39;: 0.6},
 5: {&#39;learning_rate&#39;: 0.05,
  &#39;max_depth&#39;: 10,
  &#39;n_estimators&#39;: 1200,
  &#39;subsample&#39;: 0.6},
 6: {&#39;learning_rate&#39;: 0.05,
  &#39;max_depth&#39;: 10,
  &#39;n_estimators&#39;: 1200,
  &#39;subsample&#39;: 0.6},
 7: {&#39;learning_rate&#39;: 0.05,
  &#39;max_depth&#39;: 10,
  &#39;n_estimators&#39;: 1200,
  &#39;subsample&#39;: 0.6},
 8: {&#39;learning_rate&#39;: 0.05,
  &#39;max_depth&#39;: 10,
  &#39;n_estimators&#39;: 1200,
  &#39;subsample&#39;: 0.6},
 9: {&#39;learning_rate&#39;: 0.05,
  &#39;max_depth&#39;: 10,
  &#39;n_estimators&#39;: 1200,
  &#39;subsample&#39;: 0.6},
 10: {&#39;learning_rate&#39;: 0.05,
  &#39;max_depth&#39;: 10,
  &#39;n_estimators&#39;: 1200,
  &#39;subsample&#39;: 0.6},
 11: {&#39;learning_rate&#39;: 0.05,
  &#39;max_depth&#39;: 10,
  &#39;n_estimators&#39;: 1200,
  &#39;subsample&#39;: 0.6},
 12: {&#39;learning_rate&#39;: 0.05,
  &#39;max_depth&#39;: 10,
  &#39;n_estimators&#39;: 1200,
  &#39;subsample&#39;: 0.6},
 13: {&#39;learning_rate&#39;: 0.05,
  &#39;max_depth&#39;: 10,
  &#39;n_estimators&#39;: 1200,
  &#39;subsample&#39;: 0.6},
 14: {&#39;learning_rate&#39;: 0.05,
  &#39;max_depth&#39;: 10,
  &#39;n_estimators&#39;: 1200,
  &#39;subsample&#39;: 0.6}}
</pre></div>
</div>
</div>
</div>
<p><strong>훈련된 최고 모델의 정보 저장</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">json</span>

<span class="n">file_name</span> <span class="o">=</span> <span class="s1">&#39;best_model_name.json&#39;</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">best_models_path</span> <span class="o">/</span> <span class="n">file_name</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_file</span><span class="p">:</span>
    <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">best_model_name_dict</span><span class="p">,</span> <span class="n">json_file</span><span class="p">)</span>

<span class="n">file_name</span> <span class="o">=</span> <span class="s1">&#39;test_score.json&#39;</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">best_models_path</span> <span class="o">/</span> <span class="n">file_name</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_file</span><span class="p">:</span>
    <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">test_score_dict</span><span class="p">,</span> <span class="n">json_file</span><span class="p">)</span>

<span class="n">file_name</span> <span class="o">=</span> <span class="s1">&#39;test_score_rmse.json&#39;</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">best_models_path</span> <span class="o">/</span> <span class="n">file_name</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_file</span><span class="p">:</span>
    <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">test_score_rmse_dict</span><span class="p">,</span> <span class="n">json_file</span><span class="p">)</span>

<span class="n">file_name</span> <span class="o">=</span> <span class="s1">&#39;best_params.json&#39;</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">best_models_path</span> <span class="o">/</span> <span class="n">file_name</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_file</span><span class="p">:</span>
    <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">best_params_dict</span><span class="p">,</span> <span class="n">json_file</span><span class="p">)</span>

<span class="n">file_name</span> <span class="o">=</span> <span class="s1">&#39;input_features.json&#39;</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">best_models_path</span> <span class="o">/</span> <span class="n">file_name</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_file</span><span class="p">:</span>
    <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">input_features_dict</span><span class="p">,</span> <span class="n">json_file</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><strong>최고 성능 모델 정보 불러오기</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">json</span>

<span class="n">file_name</span> <span class="o">=</span> <span class="s1">&#39;best_model_name.json&#39;</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">best_models_path</span> <span class="o">/</span> <span class="n">file_name</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_file</span><span class="p">:</span>
    <span class="n">best_model_name_dict</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">json_file</span><span class="p">)</span>

<span class="n">file_name</span> <span class="o">=</span> <span class="s1">&#39;test_score.json&#39;</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">best_models_path</span> <span class="o">/</span> <span class="n">file_name</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_file</span><span class="p">:</span>
    <span class="n">test_score_dict</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">json_file</span><span class="p">)</span>

<span class="n">file_name</span> <span class="o">=</span> <span class="s1">&#39;test_score_rmse.json&#39;</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">best_models_path</span> <span class="o">/</span> <span class="n">file_name</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_file</span><span class="p">:</span>
    <span class="n">test_score_rmse_dict</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">json_file</span><span class="p">)</span>

<span class="n">file_name</span> <span class="o">=</span> <span class="s1">&#39;best_params.json&#39;</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">best_models_path</span> <span class="o">/</span> <span class="n">file_name</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_file</span><span class="p">:</span>
    <span class="n">best_params_dict</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">json_file</span><span class="p">)</span>

<span class="n">file_name</span> <span class="o">=</span> <span class="s1">&#39;input_features.json&#39;</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">best_models_path</span> <span class="o">/</span> <span class="n">file_name</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_file</span><span class="p">:</span>
    <span class="n">input_features_dict</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">json_file</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="id16">
<h2><span class="section-number">4.8. </span>최고 모델 특성 파악<a class="headerlink" href="#id16" title="Link to this heading">#</a></h2>
<section id="id17">
<h3><span class="section-number">4.8.1. </span>특성 중요도<a class="headerlink" href="#id17" title="Link to this heading">#</a></h3>
<p>아래 함수는 훈련 후 각 특성의 중요도를 그래프로 그린다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">best_model_name_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>dict_keys([&#39;1&#39;, &#39;2&#39;, &#39;3&#39;, &#39;4&#39;, &#39;5&#39;, &#39;6&#39;, &#39;7&#39;, &#39;8&#39;, &#39;9&#39;, &#39;10&#39;, &#39;11&#39;, &#39;12&#39;, &#39;13&#39;, &#39;14&#39;])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">feature_importance_barplot</span><span class="p">(</span><span class="n">best_model_name_dict</span><span class="p">,</span> <span class="n">input_features_dict</span><span class="p">):</span>
    <span class="n">models_trained</span> <span class="o">=</span> <span class="n">best_model_name_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
    <span class="n">num_of_models</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">models_trained</span><span class="p">)</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">num_of_models</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">num_of_models</span><span class="o">*</span><span class="mi">4</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">model_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">models_trained</span><span class="p">):</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="c1"># 저장된 모델 다시 불러오기</span>
        <span class="n">best_model</span> <span class="o">=</span> <span class="n">model_name</span><span class="o">+</span><span class="s2">&quot;days.pkl&quot;</span>
        <span class="n">estimator_</span> <span class="o">=</span> <span class="n">joblib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">best_models_path</span> <span class="o">/</span> <span class="n">best_model</span><span class="p">)</span>
        <span class="c1"># 모델이 사용한 특성들 확인</span>
        <span class="n">input_features_</span> <span class="o">=</span> <span class="n">input_features_dict</span><span class="p">[</span><span class="n">model_name</span><span class="p">]</span>
        <span class="c1"># 특성 중요도 확인</span>
        <span class="n">feature_series</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">estimator_</span><span class="o">.</span><span class="n">feature_importances_</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="n">input_features_</span><span class="p">)</span>
        <span class="n">feature_series</span> <span class="o">=</span> <span class="n">feature_series</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
        <span class="c1"># 특성 중요도 막대그래프</span>
        <span class="n">colors</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">feature_series</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="n">colors</span><span class="p">[</span><span class="n">input_features_</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="s1">&#39;red&#39;</span>
        <span class="n">colors</span><span class="p">[</span><span class="n">input_features_</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]]</span> <span class="o">=</span> <span class="s1">&#39;blue&#39;</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">feature_series</span><span class="p">[:</span><span class="mi">10</span><span class="p">],</span> <span class="n">y</span> <span class="o">=</span> <span class="n">feature_series</span><span class="o">.</span><span class="n">index</span><span class="p">[:</span><span class="mi">10</span><span class="p">],</span> <span class="n">palette</span><span class="o">=</span><span class="n">colors</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">model_name</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>윈도우 크기 1부터 14까지 훈련시킨 결과 각 특성의 중요도를 그래프로 그리면 다음과 같다.</p>
<ul class="simple">
<li><p>윈도우 크기 9까지 방류량 중요도가 가장 높음.</p></li>
<li><p>윈도우 크기 4까지 방류량의 중요도가 계속 증가함.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">str</span><span class="p">(</span><span class="n">best_models_path</span> <span class="o">/</span> <span class="s2">&quot;1days.pkl&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;best_models_1\\1days.pkl&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span>

<span class="n">feature_importance_barplot</span><span class="p">(</span><span class="n">best_model_name_dict</span><span class="p">,</span> <span class="n">input_features_dict</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Figure size 2000x10000 with 0 Axes&gt;
</pre></div>
</div>
<img alt="_images/31e3d58d60bcc139621ecfe77305ccb294ed83f6b4fa4f6035f3d5f2cee37607.png" src="_images/31e3d58d60bcc139621ecfe77305ccb294ed83f6b4fa4f6035f3d5f2cee37607.png" />
</div>
</div>
<p><strong>평균 방류량 별 최선 모델의 특성 중요도</strong></p>
<p>모델 훈련에 사용된 특성을 통합하기 위해 <code class="docutils literal notranslate"><span class="pre">'?dTemp'</span></code>/<code class="docutils literal notranslate"><span class="pre">'?dDischarge'</span></code>를 <code class="docutils literal notranslate"><span class="pre">'Temp'</span></code>/<code class="docutils literal notranslate"><span class="pre">'D-Flow'</span></code>로 통일시킨 후
최선 모델의 중요도로 구성된 사전을 구현한다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 평균 방류량 별 모델의 특성 중요도</span>

<span class="n">models_trained</span> <span class="o">=</span> <span class="n">best_model_name_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>

<span class="c1"># 최선 모델 별 특성 중요도로 구성된 사전</span>
<span class="n">feature_importance_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    
<span class="k">for</span> <span class="n">model_name</span> <span class="ow">in</span> <span class="n">models_trained</span><span class="p">:</span>
    <span class="c1"># 저장된 모델 다시 불러오기</span>
    <span class="n">best_model</span> <span class="o">=</span> <span class="n">model_name</span><span class="o">+</span><span class="s2">&quot;days.pkl&quot;</span>
    <span class="n">estimator_</span> <span class="o">=</span> <span class="n">joblib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">best_models_path</span> <span class="o">/</span> <span class="n">best_model</span><span class="p">)</span>
    
    <span class="n">input_features_</span> <span class="o">=</span> <span class="n">input_features_dict</span><span class="p">[</span><span class="n">model_name</span><span class="p">]</span>

    <span class="n">feature_series</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">estimator_</span><span class="o">.</span><span class="n">feature_importances_</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="n">input_features_</span><span class="p">)</span>
    
    <span class="c1"># 특성 통일시키기</span>
    <span class="n">features</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;EC&#39;</span><span class="p">,</span> <span class="s1">&#39;TOC&#39;</span><span class="p">,</span> <span class="s1">&#39;TN&#39;</span><span class="p">,</span> <span class="s1">&#39;TP&#39;</span><span class="p">,</span> <span class="s1">&#39;WL&#39;</span><span class="p">,</span> <span class="s1">&#39;Temp&#39;</span><span class="p">,</span> <span class="s1">&#39;D-Flow&#39;</span><span class="p">]</span>
    <span class="n">feature_series</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">features</span>

    <span class="n">feature_importance_dict</span><span class="p">[</span><span class="n">model_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">feature_series</span>    
</pre></div>
</div>
</div>
</div>
<p>특성의 순서를 재배치하여 데이터프레임으로 구성한다.
인덱스는 방류량 별 모델이 사용된다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 데이터프레임 지정. 인덱스는 모델명.</span>
<span class="n">feature_importance_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">feature_importance_dict</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

<span class="c1"># 특성 순서 재배치</span>
<span class="n">features_reorderd</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;D-Flow&#39;</span><span class="p">,</span> <span class="s1">&#39;Temp&#39;</span><span class="p">,</span> <span class="s1">&#39;WL&#39;</span><span class="p">,</span> <span class="s1">&#39;EC&#39;</span><span class="p">,</span> <span class="s1">&#39;TP&#39;</span><span class="p">,</span> <span class="s1">&#39;TN&#39;</span><span class="p">,</span> <span class="s1">&#39;TOC&#39;</span><span class="p">]</span>
<span class="n">feature_importance_df</span> <span class="o">=</span> <span class="n">feature_importance_df</span><span class="p">[</span><span class="n">features_reorderd</span><span class="p">]</span>
<span class="n">feature_importance_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>D-Flow</th>
      <th>Temp</th>
      <th>WL</th>
      <th>EC</th>
      <th>TP</th>
      <th>TN</th>
      <th>TOC</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>0.290752</td>
      <td>0.237984</td>
      <td>0.158717</td>
      <td>0.137334</td>
      <td>0.056213</td>
      <td>0.062972</td>
      <td>0.056028</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.354287</td>
      <td>0.250926</td>
      <td>0.150509</td>
      <td>0.079521</td>
      <td>0.054816</td>
      <td>0.055914</td>
      <td>0.054027</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.376051</td>
      <td>0.234036</td>
      <td>0.158628</td>
      <td>0.072793</td>
      <td>0.050800</td>
      <td>0.055240</td>
      <td>0.052452</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.364934</td>
      <td>0.235602</td>
      <td>0.155647</td>
      <td>0.080809</td>
      <td>0.058101</td>
      <td>0.052811</td>
      <td>0.052096</td>
    </tr>
    <tr>
      <th>5</th>
      <td>0.336951</td>
      <td>0.249762</td>
      <td>0.158421</td>
      <td>0.095956</td>
      <td>0.059026</td>
      <td>0.048280</td>
      <td>0.051604</td>
    </tr>
    <tr>
      <th>6</th>
      <td>0.237745</td>
      <td>0.267715</td>
      <td>0.155247</td>
      <td>0.185248</td>
      <td>0.060719</td>
      <td>0.047012</td>
      <td>0.046315</td>
    </tr>
    <tr>
      <th>7</th>
      <td>0.211917</td>
      <td>0.258203</td>
      <td>0.157352</td>
      <td>0.216239</td>
      <td>0.060849</td>
      <td>0.047954</td>
      <td>0.047486</td>
    </tr>
    <tr>
      <th>8</th>
      <td>0.208809</td>
      <td>0.260998</td>
      <td>0.152573</td>
      <td>0.222404</td>
      <td>0.061569</td>
      <td>0.045138</td>
      <td>0.048508</td>
    </tr>
    <tr>
      <th>9</th>
      <td>0.209743</td>
      <td>0.252216</td>
      <td>0.156559</td>
      <td>0.220160</td>
      <td>0.062567</td>
      <td>0.046274</td>
      <td>0.052480</td>
    </tr>
    <tr>
      <th>10</th>
      <td>0.206286</td>
      <td>0.248550</td>
      <td>0.157832</td>
      <td>0.228925</td>
      <td>0.061682</td>
      <td>0.048466</td>
      <td>0.048260</td>
    </tr>
    <tr>
      <th>11</th>
      <td>0.203087</td>
      <td>0.241692</td>
      <td>0.160949</td>
      <td>0.239075</td>
      <td>0.061134</td>
      <td>0.050669</td>
      <td>0.043394</td>
    </tr>
    <tr>
      <th>12</th>
      <td>0.219470</td>
      <td>0.226946</td>
      <td>0.158227</td>
      <td>0.238321</td>
      <td>0.064161</td>
      <td>0.050966</td>
      <td>0.041908</td>
    </tr>
    <tr>
      <th>13</th>
      <td>0.218984</td>
      <td>0.232156</td>
      <td>0.155756</td>
      <td>0.238049</td>
      <td>0.063881</td>
      <td>0.049323</td>
      <td>0.041851</td>
    </tr>
    <tr>
      <th>14</th>
      <td>0.216193</td>
      <td>0.233414</td>
      <td>0.154431</td>
      <td>0.239056</td>
      <td>0.065705</td>
      <td>0.049954</td>
      <td>0.041247</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><strong>모델별 특성 중요도 막대그래프</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span> <span class="o">=</span> <span class="n">feature_importance_df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="n">stacked</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Days&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Feature importance&#39;</span><span class="p">)</span>
<span class="n">days</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">feature_importance_df</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">days</span><span class="p">))</span>
<span class="c1"># ax.set_xticklabels([str(day)+&quot;D&quot; for day in range(1, days+1)], rotation=0)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">day</span><span class="p">)</span> <span class="k">for</span> <span class="n">day</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">days</span><span class="o">+</span><span class="mi">1</span><span class="p">)],</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># ax.set_xticklabels(range(1, days+1), rotation=0)</span>
<span class="c1"># ax.set_title(&#39;Importance features for Mean of Discharge&#39;)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

<span class="n">save_fig</span><span class="p">(</span><span class="s1">&#39;Discharge-Importance-Histogram&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/eb43757c5ff4adb53eefd5c276a4459bfe505ab147d67c141b7fefbfc7cc7a52.png" src="_images/eb43757c5ff4adb53eefd5c276a4459bfe505ab147d67c141b7fefbfc7cc7a52.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span> <span class="o">=</span> <span class="n">feature_importance_df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="n">stacked</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Days&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Feature importance&#39;</span><span class="p">)</span>
<span class="n">days</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">feature_importance_df</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">days</span><span class="p">))</span>
<span class="c1"># ax.set_xticklabels([str(day)+&quot;D&quot; for day in range(1, days+1)], rotation=0)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">day</span><span class="p">)</span> <span class="k">for</span> <span class="n">day</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">days</span><span class="o">+</span><span class="mi">1</span><span class="p">)],</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># ax.set_xticklabels(range(1, days+1), rotation=0)</span>
<span class="c1"># ax.set_title(&#39;Importance features for Mean of Discharge&#39;)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.21</span><span class="p">,</span> <span class="mf">1.03</span><span class="p">))</span>

<span class="n">save_fig</span><span class="p">(</span><span class="s1">&#39;figure-abstract-1&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/8d3332872ed7d13c7a3b89620345785f6c7a558aa1a9825759d7613b84279675.png" src="_images/8d3332872ed7d13c7a3b89620345785f6c7a558aa1a9825759d7613b84279675.png" />
</div>
</div>
</section>
<section id="id18">
<h3><span class="section-number">4.8.2. </span>모델 성능<a class="headerlink" href="#id18" title="Link to this heading">#</a></h3>
<p>아래 그래프는 윈도우 크기에 따른 모델의 테스트 성능(score 기준)의 변화를 보여준다.
정확도의 성능이 최고 0.971328까지 올라간다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">r2_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">test_score_dict</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;$\mathdefault</span><span class="si">{R}</span><span class="s1">^2$&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
<span class="n">r2_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>$\mathdefault{R}^2$</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>0.972864</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.977074</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.978234</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.979630</td>
    </tr>
    <tr>
      <th>5</th>
      <td>0.980626</td>
    </tr>
    <tr>
      <th>6</th>
      <td>0.981308</td>
    </tr>
    <tr>
      <th>7</th>
      <td>0.981424</td>
    </tr>
    <tr>
      <th>8</th>
      <td>0.981196</td>
    </tr>
    <tr>
      <th>9</th>
      <td>0.981877</td>
    </tr>
    <tr>
      <th>10</th>
      <td>0.981992</td>
    </tr>
    <tr>
      <th>11</th>
      <td>0.982409</td>
    </tr>
    <tr>
      <th>12</th>
      <td>0.982674</td>
    </tr>
    <tr>
      <th>13</th>
      <td>0.983329</td>
    </tr>
    <tr>
      <th>14</th>
      <td>0.982803</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span> <span class="o">=</span> <span class="n">r2_df</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Days&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$\mathdefault</span><span class="si">{R}</span><span class="s1">^2$&#39;</span><span class="p">)</span>
<span class="n">days</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">r2_df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">days</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">day</span><span class="p">)</span> <span class="k">for</span> <span class="n">day</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">days</span><span class="o">+</span><span class="mi">1</span><span class="p">)],</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># ax.set_title(&#39;R2 Scores for Mean of Flow&#39;)</span>

<span class="n">save_fig</span><span class="p">(</span><span class="s1">&#39;Discharge_score_mean&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/a58f49324de7af45429fcf1ad62d5ac2702fcbb92480ccbda9f4a1365cd54f5b.png" src="_images/a58f49324de7af45429fcf1ad62d5ac2702fcbb92480ccbda9f4a1365cd54f5b.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">neg_rmse_df</span> <span class="o">=</span> <span class="o">-</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">test_score_rmse_dict</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;neg. RMSE&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
<span class="n">neg_rmse_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>neg. RMSE</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>-0.146609</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-0.134756</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-0.131305</td>
    </tr>
    <tr>
      <th>4</th>
      <td>-0.127023</td>
    </tr>
    <tr>
      <th>5</th>
      <td>-0.123880</td>
    </tr>
    <tr>
      <th>6</th>
      <td>-0.121679</td>
    </tr>
    <tr>
      <th>7</th>
      <td>-0.121302</td>
    </tr>
    <tr>
      <th>8</th>
      <td>-0.122042</td>
    </tr>
    <tr>
      <th>9</th>
      <td>-0.119813</td>
    </tr>
    <tr>
      <th>10</th>
      <td>-0.119432</td>
    </tr>
    <tr>
      <th>11</th>
      <td>-0.118040</td>
    </tr>
    <tr>
      <th>12</th>
      <td>-0.117149</td>
    </tr>
    <tr>
      <th>13</th>
      <td>-0.114913</td>
    </tr>
    <tr>
      <th>14</th>
      <td>-0.116713</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span> <span class="o">=</span> <span class="n">neg_rmse_df</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Days&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;neg. RMSE&#39;</span><span class="p">)</span>
<span class="n">days</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">neg_rmse_df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">days</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">day</span><span class="p">)</span> <span class="k">for</span> <span class="n">day</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">days</span><span class="o">+</span><span class="mi">1</span><span class="p">)],</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># ax.set_title(&#39;RMSE for Mean of Flow&#39;)</span>

<span class="c1"># save_fig(&#39;Discharge_score_mean&#39;)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/7f10a8642e0f62bbc7cbb2380a25e19f0c1a525e026aeadd9d1d67ead2330765.png" src="_images/7f10a8642e0f62bbc7cbb2380a25e19f0c1a525e026aeadd9d1d67ead2330765.png" />
</div>
</div>
<p>두 점수를 한 번에 표시한다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">score_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">r2_df</span><span class="p">,</span> <span class="n">neg_rmse_df</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">score_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>$\mathdefault{R}^2$</th>
      <th>neg. RMSE</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>0.972864</td>
      <td>-0.146609</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.977074</td>
      <td>-0.134756</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.978234</td>
      <td>-0.131305</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.979630</td>
      <td>-0.127023</td>
    </tr>
    <tr>
      <th>5</th>
      <td>0.980626</td>
      <td>-0.123880</td>
    </tr>
    <tr>
      <th>6</th>
      <td>0.981308</td>
      <td>-0.121679</td>
    </tr>
    <tr>
      <th>7</th>
      <td>0.981424</td>
      <td>-0.121302</td>
    </tr>
    <tr>
      <th>8</th>
      <td>0.981196</td>
      <td>-0.122042</td>
    </tr>
    <tr>
      <th>9</th>
      <td>0.981877</td>
      <td>-0.119813</td>
    </tr>
    <tr>
      <th>10</th>
      <td>0.981992</td>
      <td>-0.119432</td>
    </tr>
    <tr>
      <th>11</th>
      <td>0.982409</td>
      <td>-0.118040</td>
    </tr>
    <tr>
      <th>12</th>
      <td>0.982674</td>
      <td>-0.117149</td>
    </tr>
    <tr>
      <th>13</th>
      <td>0.983329</td>
      <td>-0.114913</td>
    </tr>
    <tr>
      <th>14</th>
      <td>0.982803</td>
      <td>-0.116713</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">colormaps</span> <span class="k">as</span> <span class="n">cm</span>

<span class="k">def</span> <span class="nf">plot_df</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">x_column</span><span class="p">,</span> <span class="n">columns</span><span class="p">):</span>

    <span class="n">cmap</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;tab10&#39;</span><span class="p">)</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

    <span class="n">axes</span> <span class="o">=</span> <span class="p">[</span><span class="n">ax</span><span class="p">]</span>
    <span class="n">handles</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">columns</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)):</span>
        <span class="n">twin</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">twin</span><span class="p">)</span>
        <span class="n">twin</span><span class="o">.</span><span class="n">spines</span><span class="o">.</span><span class="n">right</span><span class="o">.</span><span class="n">set_position</span><span class="p">((</span><span class="s2">&quot;axes&quot;</span><span class="p">,</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">i</span><span class="o">/</span><span class="mi">10</span><span class="p">))</span>

    <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">columns</span><span class="p">):</span>
        <span class="n">ylabel</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">col</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">p</span><span class="p">,</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">x_column</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">label</span> <span class="o">=</span> <span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">(</span><span class="n">j</span><span class="p">)[:</span><span class="mi">3</span><span class="p">])</span>
            <span class="n">ylabel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">handles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
            <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">sub_col</span> <span class="ow">in</span> <span class="n">col</span><span class="p">:</span>
                <span class="n">p</span><span class="p">,</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">x_column</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="n">sub_col</span><span class="p">],</span> <span class="n">label</span> <span class="o">=</span> <span class="n">sub_col</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">(</span><span class="n">j</span><span class="p">)[:</span><span class="mi">3</span><span class="p">])</span>
                <span class="n">ylabel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sub_col</span><span class="p">)</span>
                <span class="n">handles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
                <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ylabel</span><span class="p">),</span> <span class="n">x</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span> <span class="o">=</span> <span class="n">handles</span><span class="p">,</span> <span class="n">frameon</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">x_column</span><span class="p">)</span>

    <span class="c1"># ax.grid(axis=&#39;x&#39;)</span>

    <span class="c1"># plt.tight_layout()</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_df</span><span class="p">(</span><span class="n">score_df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;index&#39;</span><span class="p">:</span><span class="s1">&#39;Days&#39;</span><span class="p">}),</span> <span class="s1">&#39;Days&#39;</span><span class="p">,</span> <span class="p">[[</span><span class="s1">&#39;$\mathdefault</span><span class="si">{R}</span><span class="s1">^2$&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;neg. RMSE&#39;</span><span class="p">]])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/905562d8adad81ad007d787ba6330b30dfdb47052f74e7fce7ac0f31aa66bec6.png" src="_images/905562d8adad81ad007d787ba6330b30dfdb47052f74e7fce7ac0f31aa66bec6.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">colormaps</span> <span class="k">as</span> <span class="n">cm</span>

<span class="k">def</span> <span class="nf">plot_df</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">x_column</span><span class="p">,</span> <span class="n">columns</span><span class="p">):</span>

    <span class="n">cmap</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;tab10&#39;</span><span class="p">)</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

    <span class="n">axes</span> <span class="o">=</span> <span class="p">[</span><span class="n">ax</span><span class="p">]</span>
    <span class="n">handles</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">columns</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)):</span>
        <span class="n">twin</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">twin</span><span class="p">)</span>
        <span class="n">twin</span><span class="o">.</span><span class="n">spines</span><span class="o">.</span><span class="n">right</span><span class="o">.</span><span class="n">set_position</span><span class="p">((</span><span class="s2">&quot;axes&quot;</span><span class="p">,</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">i</span><span class="o">/</span><span class="mi">10</span><span class="p">))</span>

    <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">columns</span><span class="p">):</span>
        <span class="n">ylabel</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">col</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">p</span><span class="p">,</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">x_column</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">label</span> <span class="o">=</span> <span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">(</span><span class="n">j</span><span class="p">)[:</span><span class="mi">3</span><span class="p">])</span>
            <span class="n">ylabel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">handles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
            <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">sub_col</span> <span class="ow">in</span> <span class="n">col</span><span class="p">:</span>
                <span class="n">p</span><span class="p">,</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">x_column</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="n">sub_col</span><span class="p">],</span> <span class="n">label</span> <span class="o">=</span> <span class="n">sub_col</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">(</span><span class="n">j</span><span class="p">)[:</span><span class="mi">3</span><span class="p">])</span>
                <span class="n">ylabel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sub_col</span><span class="p">)</span>
                <span class="n">handles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
                <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ylabel</span><span class="p">),</span> <span class="n">x</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span> <span class="o">=</span> <span class="n">handles</span><span class="p">,</span> <span class="n">frameon</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">x_column</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>

    <span class="c1"># plt.tight_layout()</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_df</span><span class="p">(</span><span class="n">score_df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;index&#39;</span><span class="p">:</span><span class="s1">&#39;Days&#39;</span><span class="p">}),</span> <span class="s1">&#39;Days&#39;</span><span class="p">,</span> <span class="p">[[</span><span class="s1">&#39;$\mathdefault</span><span class="si">{R}</span><span class="s1">^2$&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;neg. RMSE&#39;</span><span class="p">]])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/169bdf7219c1df129b982c8ebdeff8641256e0590898dd01ee439464c20289a3.png" src="_images/169bdf7219c1df129b982c8ebdeff8641256e0590898dd01ee439464c20289a3.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">colormaps</span> <span class="k">as</span> <span class="n">cm</span>

<span class="k">def</span> <span class="nf">plot_df_</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">x_column</span><span class="p">,</span> <span class="n">columns</span><span class="p">):</span>

    <span class="n">cmap</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;tab10&#39;</span><span class="p">)</span>

    <span class="n">axes</span> <span class="o">=</span> <span class="p">[</span><span class="n">ax</span><span class="p">]</span>
    <span class="n">handles</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">columns</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)):</span>
        <span class="n">twin</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">twin</span><span class="p">)</span>
        <span class="n">twin</span><span class="o">.</span><span class="n">spines</span><span class="o">.</span><span class="n">right</span><span class="o">.</span><span class="n">set_position</span><span class="p">((</span><span class="s2">&quot;axes&quot;</span><span class="p">,</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">i</span><span class="o">/</span><span class="mi">10</span><span class="p">))</span>

    <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">columns</span><span class="p">):</span>
        <span class="n">ylabel</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">col</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">p</span><span class="p">,</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">x_column</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">label</span> <span class="o">=</span> <span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">(</span><span class="n">j</span><span class="p">)[:</span><span class="mi">3</span><span class="p">])</span>
            <span class="n">ylabel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">handles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
            <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">sub_col</span> <span class="ow">in</span> <span class="n">col</span><span class="p">:</span>
                <span class="n">p</span><span class="p">,</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">x_column</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="n">sub_col</span><span class="p">],</span> <span class="n">label</span> <span class="o">=</span> <span class="n">sub_col</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">(</span><span class="n">j</span><span class="p">)[:</span><span class="mi">3</span><span class="p">])</span>
                <span class="n">ylabel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sub_col</span><span class="p">)</span>
                <span class="n">handles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
                <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ylabel</span><span class="p">),</span> <span class="n">x</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span> <span class="o">=</span> <span class="n">handles</span><span class="p">,</span> <span class="n">frameon</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">loc</span> <span class="o">=</span> <span class="s1">&#39;lower right&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">x_column</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">h_pad</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mf">11.2</span><span class="p">))</span>
<span class="c1"># fig.subplots_adjust(hspace=30)</span>

<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plot_df_</span><span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">score_df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;index&#39;</span><span class="p">:</span><span class="s1">&#39;Days&#39;</span><span class="p">}),</span> <span class="s1">&#39;Days&#39;</span><span class="p">,</span> <span class="p">[[</span><span class="s1">&#39;$\mathdefault</span><span class="si">{R}</span><span class="s1">^2$&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;neg. RMSE&#39;</span><span class="p">]])</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;(a)&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.03</span><span class="p">,</span> <span class="n">x</span><span class="o">=-</span><span class="mf">0.025</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">22</span><span class="p">)</span>

<span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">feature_importance_df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="n">stacked</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>

<span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">22</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.325</span><span class="p">,</span> <span class="mf">1.035</span><span class="p">))</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Days&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">22</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Feature importance&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">22</span><span class="p">)</span>
<span class="n">days</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">feature_importance_df</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">days</span><span class="p">))</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">day</span><span class="p">)</span> <span class="k">for</span> <span class="n">day</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">days</span><span class="o">+</span><span class="mi">1</span><span class="p">)],</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;(b)&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.03</span><span class="p">,</span> <span class="n">x</span><span class="o">=-</span><span class="mf">0.025</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">22</span><span class="p">)</span>

<span class="n">save_fig</span><span class="p">(</span><span class="s1">&#39;figure5a&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/c72700c64d17bef14c63f4ec34b173f19d11ec5b5179d6a9fc98f101c458988d.png" src="_images/c72700c64d17bef14c63f4ec34b173f19d11ec5b5179d6a9fc98f101c458988d.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">colormaps</span> <span class="k">as</span> <span class="n">cm</span>

<span class="k">def</span> <span class="nf">plot_df_</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">x_column</span><span class="p">,</span> <span class="n">columns</span><span class="p">):</span>

    <span class="n">cmap</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;tab10&#39;</span><span class="p">)</span>

    <span class="n">axes</span> <span class="o">=</span> <span class="p">[</span><span class="n">ax</span><span class="p">]</span>
    <span class="n">handles</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">columns</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)):</span>
        <span class="n">twin</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">twin</span><span class="p">)</span>
        <span class="n">twin</span><span class="o">.</span><span class="n">spines</span><span class="o">.</span><span class="n">right</span><span class="o">.</span><span class="n">set_position</span><span class="p">((</span><span class="s2">&quot;axes&quot;</span><span class="p">,</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">i</span><span class="o">/</span><span class="mi">10</span><span class="p">))</span>

    <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">columns</span><span class="p">):</span>
        <span class="n">ylabel</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">col</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">p</span><span class="p">,</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">x_column</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">label</span> <span class="o">=</span> <span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">(</span><span class="n">j</span><span class="p">)[:</span><span class="mi">3</span><span class="p">])</span>
            <span class="n">ylabel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">handles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
            <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">sub_col</span> <span class="ow">in</span> <span class="n">col</span><span class="p">:</span>
                <span class="n">p</span><span class="p">,</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">x_column</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="n">sub_col</span><span class="p">],</span> <span class="n">label</span> <span class="o">=</span> <span class="n">sub_col</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">(</span><span class="n">j</span><span class="p">)[:</span><span class="mi">3</span><span class="p">])</span>
                <span class="n">ylabel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sub_col</span><span class="p">)</span>
                <span class="n">handles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
                <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ylabel</span><span class="p">),</span> <span class="n">x</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span> <span class="o">=</span> <span class="n">handles</span><span class="p">,</span> <span class="n">frameon</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">loc</span> <span class="o">=</span> <span class="s1">&#39;lower right&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">x_column</span><span class="p">)</span>
    <span class="c1"># ax.grid(axis=&#39;x&#39;)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">h_pad</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mf">11.2</span><span class="p">))</span>
<span class="c1"># fig.subplots_adjust(hspace=30)</span>

<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plot_df_</span><span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">score_df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;index&#39;</span><span class="p">:</span><span class="s1">&#39;Days&#39;</span><span class="p">}),</span> <span class="s1">&#39;Days&#39;</span><span class="p">,</span> <span class="p">[[</span><span class="s1">&#39;$\mathdefault</span><span class="si">{R}</span><span class="s1">^2$&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;neg. RMSE&#39;</span><span class="p">]])</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;(a)&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.03</span><span class="p">,</span> <span class="n">x</span><span class="o">=-</span><span class="mf">0.025</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">22</span><span class="p">)</span>

<span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">feature_importance_df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="n">stacked</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>

<span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">22</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.325</span><span class="p">,</span> <span class="mf">1.035</span><span class="p">))</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Days&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">22</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Feature importance&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">22</span><span class="p">)</span>
<span class="n">days</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">feature_importance_df</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">days</span><span class="p">))</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">day</span><span class="p">)</span> <span class="k">for</span> <span class="n">day</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">days</span><span class="o">+</span><span class="mi">1</span><span class="p">)],</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;(b)&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.03</span><span class="p">,</span> <span class="n">x</span><span class="o">=-</span><span class="mf">0.025</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">22</span><span class="p">)</span>

<span class="n">save_fig</span><span class="p">(</span><span class="s1">&#39;figure5&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/6e930e711f38aedfbeeef34512450fa164154202bb8726e242612df5a6cad41b.png" src="_images/6e930e711f38aedfbeeef34512450fa164154202bb8726e242612df5a6cad41b.png" />
</div>
</div>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="scb_seasonal_flow_chla.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">3. </span>승촌보: 계절별 방류량과 클로로필-a</p>
      </div>
    </a>
    <a class="right-next"
       href="jsb_basics_240830.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">5. </span>죽산보 데이터 분석</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">4.1. 데이터 정보</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">4.2. 주요 내용</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">4.3. 필수 모듈 임포트</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">4.4. 승촌보 데이터 불러오기</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">4.4.1. 수질 데이터 불러오기</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">4.4.2. 승촌보 유량 데이터 추가</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id8">4.4.3. 연도별 유량 데이터 통합</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id9">4.4.4. 수질/유량 데이터 합병</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id10">4.4.5. 이상치 제거</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id11">4.5. 데이터셋 전처리</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id12">4.5.1. 클로로필 정규화</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id13">4.5.2. 결측치 보간</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id14">4.6. 방류량과 수온의 평균값 활용</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id15">4.7. 모델 훈련</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#gradientboosting">4.7.1. GradientBoosting</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id16">4.8. 최고 모델 특성 파악</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id17">4.8.1. 특성 중요도</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id18">4.8.2. 모델 성능</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By 코딩알지
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>